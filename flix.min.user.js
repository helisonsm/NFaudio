// ==UserScript==
// @name        Flix
// @description User script para facilitar download de legendas e Ã¡udios na(o) Netflix
// @include     https://www.netflix.com/*
// @copyright   2017, XOR
// @author      XOR
// @version     1.0.0
// @namespace   @XOR
// @icon        data:image/png;base64,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
// @grant       none
// @homepageURL https://gist.github.com/xor10/8f65c1e66a34386e1131f8c28ff6bf64
// @downloadURL https://gist.github.com/xor10/8f65c1e66a34386e1131f8c28ff6bf64/raw/flix.min.user.js
// @updateURL   https://gist.github.com/xor10/8f65c1e66a34386e1131f8c28ff6bf64/raw/flix.min.user.js
// @run-at      document-start
// ==/UserScript==
'use strict';var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,f,g){if(g.get||g.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[f]=g.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var f=0;return $jscomp.iteratorPrototype(function(){return f<a.length?{done:!1,value:a[f++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();var f=a[Symbol.iterator];return f?f.call(a):$jscomp.arrayIterator(a)};
$jscomp.polyfill=function(a,f,g,e){if(f){g=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var r=a[e];r in g||(g[r]={});g=g[r]}a=a[a.length-1];e=g[a];f=f(e);f!=e&&null!=f&&$jscomp.defineProperty(g,a,{configurable:!0,writable:!0,value:f})}};$jscomp.EXPOSE_ASYNC_EXECUTOR=!0;$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function f(){this.batch_=null}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;f.prototype.asyncExecute=function(c){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(c);return this};f.prototype.asyncExecuteBatch_=function(){var c=this;this.asyncExecuteFunction(function(){c.executeBatch_()})};var g=$jscomp.global.setTimeout;f.prototype.asyncExecuteFunction=function(c){setTimeout(c,0)};f.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var c=
this.batch_;this.batch_=[];for(var l=0;l<c.length;++l){var a=c[l];delete c[l];try{a()}catch(B){this.asyncThrow_(B)}}}this.batch_=null};f.prototype.asyncThrow_=function(c){this.asyncExecuteFunction(function(){throw c;})};var e=function(c){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var l=this.createResolveAndReject_();try{c(l.resolve,l.reject)}catch(A){l.reject(A)}};e.prototype.createResolveAndReject_=function(){function c(c){return function(e){a||(a=!0,c.call(l,e))}}var l=this,a=
!1;return{resolve:c(this.resolveTo_),reject:c(this.reject_)}};e.prototype.resolveTo_=function(c){if(c===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(c instanceof e)this.settleSameAsPromise_(c);else{a:switch(typeof c){case "object":var a=null!=c;break a;case "function":a=!0;break a;default:a=!1}a?this.resolveToNonPromiseObj_(c):this.fulfill_(c)}};e.prototype.resolveToNonPromiseObj_=function(c){var a=void 0;try{a=c.then}catch(A){this.reject_(A);return}"function"==typeof a?
this.settleSameAsThenable_(a,c):this.fulfill_(c)};e.prototype.reject_=function(c){this.settle_(2,c)};e.prototype.fulfill_=function(c){this.settle_(1,c)};e.prototype.settle_=function(c,a){if(0!=this.state_)throw Error("Cannot settle("+c+", "+a|"): Promise already settled in state"+this.state_);this.state_=c;this.result_=a;this.executeOnSettledCallbacks_()};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var c=this.onSettledCallbacks_,a=0;a<c.length;++a)c[a].call(),
c[a]=null;this.onSettledCallbacks_=null}};var r=new f;e.prototype.settleSameAsPromise_=function(c){var a=this.createResolveAndReject_();c.callWhenSettled_(a.resolve,a.reject)};e.prototype.settleSameAsThenable_=function(a,e){var c=this.createResolveAndReject_();try{a.call(e,c.resolve,c.reject)}catch(B){c.reject(B)}};e.prototype.then=function(a,f){function c(a,c){return"function"==typeof a?function(c){try{l(a(c))}catch(D){g(D)}}:c}var l,g,r=new e(function(a,c){l=a;g=c});this.callWhenSettled_(c(a,l),
c(f,g));return r};e.prototype.catch=function(a){return this.then(void 0,a)};e.prototype.callWhenSettled_=function(a,e){function c(){switch(f.state_){case 1:a(f.result_);break;case 2:e(f.result_);break;default:throw Error("Unexpected state: "+f.state_);}}var f=this;null==this.onSettledCallbacks_?r.asyncExecute(c):this.onSettledCallbacks_.push(function(){r.asyncExecute(c)})};e.resolve=function(a){return a instanceof e?a:new e(function(c,e){c(a)})};e.reject=function(a){return new e(function(c,e){e(a)})};
e.race=function(a){return new e(function(c,f){for(var l=$jscomp.makeIterator(a),g=l.next();!g.done;g=l.next())e.resolve(g.value).callWhenSettled_(c,f)})};e.all=function(a){var c=$jscomp.makeIterator(a),f=c.next();return f.done?e.resolve([]):new e(function(a,g){function l(c){return function(e){r[c]=e;y--;0==y&&a(r)}}var r=[],y=0;do r.push(void 0),y++,e.resolve(f.value).callWhenSettled_(l(r.length-1),g),f=c.next();while(!f.done)})};$jscomp.EXPOSE_ASYNC_EXECUTOR&&(e.$jscomp$new$AsyncExecutor=function(){return new f});
return e},"es6-impl","es3");$jscomp.executeAsyncGenerator=function(a){function f(e){return a.next(e)}function g(e){return a.throw(e)}return new Promise(function(e,r){function c(a){a.done?e(a.value):Promise.resolve(a.value).then(f,g).then(c,r)}c(a.next())})};
(function(){function a(){var a=/^(.*?)@(.+?):(\d+):(\d+)$/,d=Error().stack.split("\n").slice(2),b=a.exec(d[0]);this.lineNumber=parseInt(b[3],10);this.columnNumber=parseInt(b[4],10);var c=[];d.forEach(function(b){b&&(b=a.exec(b),c.push(b[1]+"@"+b[3]+":"+b[4]))});this.stack=c.join("\n")}function f(m){a.call(this);this.message=m}function g(a,d){var b={headers:{"Content-Type":"text/plain"},credentials:"include"};Object.keys(d||{}).forEach(function(a){"headers"===a?Object.keys(headers).forEach(function(a){return b.headers[a]=
d.headers[a]}):b[a]=d[a]});b.method="POST";return fetch(a,b).then(function(b){return b.text()})}function e(a){return $jscomp.executeAsyncGenerator(function(){function d(d,k){for(;;)switch(b){case 0:return b=1,{value:crypto.subtle.sign({name:"HMAC"},v.hmacKey,G.encode(a)).then(function(b){return new Uint8Array(b)}),done:!1};case 1:if(void 0===k){b=2;break}b=-1;throw k;case 2:return c=m=d,b=-1,{value:x.fromByteArray(c),done:!0};default:return{value:void 0,done:!0}}}var b=0,c,m,k={next:function(b){return d(b,
void 0)},throw:function(b){return d(void 0,b)},return:function(b){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();k[Symbol.iterator]=function(){return this};return k}())}function r(a){var d=new Uint8Array(a);for(--a;0<=a;--a)d[a]=256*Math.random();return d}function c(a){return $jscomp.executeAsyncGenerator(function(){function d(d,h){for(;;)switch(b){case 0:return n=r(16),k={keyid:v.esn+"_"+v.sequencenumber,sha256:"AA==",iv:x.fromByteArray(n)},b=1,{value:crypto.subtle.encrypt({name:"AES-CBC",
iv:n},v.encryptionKey,G.encode(a)).then(function(b){return new Uint8Array(b)}),done:!1};case 1:if(void 0===h){b=2;break}b=-1;throw h;case 2:return c=m=d,k.ciphertext=x.fromByteArray(c),b=-1,{value:JSON.stringify(k),done:!0};default:return{value:void 0,done:!0}}}var b=0,c,m,k,n,e={next:function(b){return d(b,void 0)},throw:function(b){return d(void 0,b)},return:function(b){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();e[Symbol.iterator]=function(){return this};return e}())}function l(){return $jscomp.executeAsyncGenerator(function(){function a(a,
h){for(;;)switch(d){case 0:return d=1,{value:crypto.subtle.exportKey("spki",v.keyxPublicKey).then(function(b){return new Uint8Array(b)}),done:!1};case 1:if(void 0===h){d=2;break}d=-1;throw h;case 2:return b=c=a,d=-1,{value:x.fromByteArray(b),done:!0};default:return{value:void 0,done:!0}}}var d=0,b,c,h={next:function(b){return a(b,void 0)},throw:function(b){return a(void 0,b)},return:function(b){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();h[Symbol.iterator]=function(){return this};
return h}())}function A(a){return $jscomp.executeAsyncGenerator(function(){function d(d,e){for(;;)switch(b){case 0:return m=Math.random()*Math.pow(2,52),h=k={sender:v.esn,capabilities:{languages:[],compressionalgos:a&&(Array.isArray(a)?a:[a])||[]},renewable:!0,messageid:m},b=1,{value:l(),done:!1};case 1:if(void 0===e){b=2;break}b=-1;throw e;case 2:c=d;h.keyrequestdata=[{scheme:"ASYMMETRIC_WRAPPED",keydata:{publickey:c,mechanism:"JWK_RSA",keypairid:"rsaKeypairId"}}];if(v.userList&&v.userList.length){d=
[];e=$jscomp.makeIterator(v.userList[0].serviceTokenJSONList);for(var n=e.next();!n.done;n=e.next())d.push(n.value);k.useridtoken=v.userList[0].userIdTokenJSON;k.servicetokens=d}k.userauthdata={scheme:"NETFLIXID",authdata:{}};b=-1;return{value:{id:m,header:JSON.stringify(k)},done:!0};default:return{value:void 0,done:!0}}}var b=0,c,h,k,m,e={next:function(b){return d(b,void 0)},throw:function(b){return d(void 0,b)},return:function(b){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();
e[Symbol.iterator]=function(){return this};return e}())}function B(a){return $jscomp.executeAsyncGenerator(function(){function d(d,p){for(;;)switch(b){case 0:return b=1,{value:A(),done:!1};case 1:if(void 0===p){b=2;break}b=-1;throw p;case 2:return E=r=d,b=3,{value:c(E.header),done:!1};case 3:if(void 0===p){b=4;break}b=-1;throw p;case 4:return g=l=d,H=v.masterTokenJSON,I=window.btoa(g),b=5,{value:e(g),done:!1};case 5:if(void 0===p){b=6;break}b=-1;throw p;case 6:return J=d,q={mastertoken:H,headerdata:I,
signature:J},t='[{},{"headers":{},"path":"/cbp/cadmium-13","payload":{"data":"'+JSON.stringify(a).replace(/"/g,'\\"')+'"},"query":""}]',u=x.fromByteArray(Q.compress(t)),w={messageid:E.id,data:u,compressionalgo:"LZW",sequencenumber:1,endofmsg:!0},b=7,{value:c(JSON.stringify(w)),done:!1};case 7:if(void 0===p){b=8;break}b=-1;throw p;case 8:return z=f=d,n=window.btoa(z),b=9,{value:e(z),done:!1};case 9:if(void 0===p){b=10;break}b=-1;throw p;case 10:return k=d,h={payload:n,signature:k},m=JSON.stringify(q)+
JSON.stringify(h),b=-1,{value:m,done:!0};default:return{value:void 0,done:!0}}}var b=0,m,h,k,n,z,f,w,u,t,q,J,I,H,g,l,E,r,C={next:function(b){return d(b,void 0)},throw:function(b){return d(void 0,b)},return:function(b){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();C[Symbol.iterator]=function(){return this};return C}())}function L(a){return $jscomp.executeAsyncGenerator(function(){function d(d,n){for(;;)switch(b){case 0:if(v){b=1;break}b=-1;throw new f("MSL is undefined!");case 1:return w=
{method:"manifest",lookupType:"PREPARE",viewableIds:Array.isArray(a)?a:[a],profiles:"playready-h264bpl30-dash playready-h264mpl30-dash playready-h264mpl31-dash playready-h264mpl40-dash heaac-2-dash ddplus-2.0-dash ddplus-5.1-dash dfxp-ls-sdh".split(" "),drmSystem:"widevine",appId:"14673889385265",sessionParams:{pinCapableClient:!1,uiplaycontext:"null"},sessionId:"14673889385265",trackId:0,flavor:"PRE_FETCH",secureUrls:!0,supportPreviewContent:!0,forceClearStreams:!1,languages:["en-US"],clientVersion:"4.0004.899.011",
uiVersion:"akira"},b=2,{value:B(w),done:!1};case 2:if(void 0===n){b=3;break}b=-1;throw n;case 3:return m=P=d,b=4,{value:g(R.manifest,{body:m}),done:!1};case 4:if(void 0===n){b=5;break}b=-1;throw n;case 5:k=e=d;b=6;d=O;n=void 0;for(var t=k,p=0,z=0,q=0,u=[],l=0,r=t.length;p<r;){var C=t.charAt(p);"{"===C&&++z;"}"===C&&++q;z===q&&(n?u.push(t.slice(l,p+1)):n=t.slice(0,p+1),l=p+1);++p}return{value:d(u[0]),done:!1};case 6:if(void 0===n){b=7;break}b=-1;throw n;case 7:return c=h=d,b=-1,{value:c,done:!0};default:return{value:void 0,
done:!0}}}var b=0,c,h,k,e,m,P,w,u={next:function(b){return d(b,void 0)},throw:function(b){return d(void 0,b)},return:function(b){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();u[Symbol.iterator]=function(){return this};return u}())}function O(a){return $jscomp.executeAsyncGenerator(function(){function d(d,p){for(;;)switch(b){case 0:return w=JSON.parse(a),f=JSON.parse(window.atob(w.payload)),m=x.toByteArray(f.iv),e=x.toByteArray(f.ciphertext),b=1,{value:crypto.subtle.decrypt({name:"AES-CBC",
iv:m},v.encryptionKey,e).then(function(b){return new Uint8Array(b)}),done:!1};case 1:if(void 0===p){b=2;break}b=-1;throw p;case 2:return h=k=d,c=JSON.parse((new TextDecoder).decode(h)),e=window.atob(c.data),e=JSON.parse(e)[1].payload.data,e=window.atob(e),b=-1,{value:JSON.parse(e),done:!0};default:return{value:void 0,done:!0}}}var b=0,c,h,k,e,m,f,w,u={next:function(b){return d(b,void 0)},throw:function(b){return d(void 0,b)},return:function(b){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();
u[Symbol.iterator]=function(){return this};return u}())}function M(){return $jscomp.executeAsyncGenerator(function(){function a(a,h){for(;;)switch(d){case 0:if(!u){d=1;break}d=-1;return{value:void 0,done:!0};case 1:u=!0;w=window.location.pathname;g=/^\/watch\/(\d{4,})$/;f=g.exec(w);if(!f){d=2;break}if(n=document.getElementById("box")){d=3;break}F=!0;k=document.createElement("div");k.id="overlay";document.body.appendChild(k);S.pause();d=5;return{value:L([parseInt(f[1])]),done:!1};case 5:if(void 0===
h){d=6;break}d=-1;throw h;case 6:c=e=a;b={};K(c.result.viewables[0].audioTracks,b,"audios");K(c.result.viewables[0].textTracks,b,"subtitles");T(b);d=4;break;case 3:F=!1,document.getElementById("overlay").remove(),n.remove();case 4:case 2:u=!1,d=-1;default:return{value:void 0,done:!0}}}var d=0,b,c,e,k,n,f,g,w,u,t={next:function(b){return a(b,void 0)},throw:function(b){return a(void 0,b)},return:function(b){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();t[Symbol.iterator]=function(){return this};
return t}())}function y(a,d){a=""+a;return"0".repeat(Math.max(0,d-a.length))+a}function N(a){var d=function(b,a){b=""+b;return"0".repeat(Math.max(0,a-b.length))+b},b=function(b){var a=Math.round(~~b.substr(-8,7)/1E4);b=~~b.slice(0,-8);var c=b%60,e=Math.floor(b/60%60);return d(Math.floor(b/3600),2)+":"+d(e,2)+":"+d(c,2)+","+d(a,3)},c=(new DOMParser).parseFromString(a,"text/xml"),e=[];a=c.getElementsByTagName("style");for(var k=a.length-1;0<=k;--k){var n=a[k];"italic"===n.getAttribute("tts:fontStyle")&&
e.push(n.getAttribute("xml:id"))}a=function(b,a){return~e.indexOf(a.getAttribute("style"))?"<i>"+b+"</i>":b};for(var c=c.getElementsByTagName("p"),k=c.length,n="",f=0,m=1;f<k;){for(var w=c[f++],u=w.childNodes,t=u.length,q="",g=0;g<t;++g){var l=u[g];"br"===l.tagName?q+="\n":l.textContent&&(q="span"===l.tagName?q+a(l.textContent,l):q+l.textContent)}q&&(u=b(w.getAttribute("begin")),t=b(w.getAttribute("end")),q=a(q,w),n+=m++ +"\n"+u+" --\x3e "+t+"\n"+q.replace(/<\/i>\n<i>/g,"\n")+"\n\n")}return n}function D(){var a=
document.querySelector(".player-status-main-title");if(a){var d=a.nextSibling;if(d)return d=/(\d+):.+?(\d+)$/.exec(d.textContent),a.textContent+".S"+y(d[1],2)+"E"+y(d[2],2)}return a&&a.textContent||""}function T(a){function d(b,a){b=new Blob([b.replace(/(\r)?\n/g,"\r\n")],{type:"application/octet-stream"});var d=window.URL.createObjectURL(b);b=document.createElement("a");b.style.display="none";b.download=a||"legenda.srt";b.href=d;setTimeout(function(){return window.URL.revokeObjectURL(d)},1E4);document.body.appendChild(b);
b.click()}function b(b,a,c,k){var h=document.createElement("span"),f=document.createElement("br");h.className="prefix";h.textContent={"heaac-2-dash":"\u00c1udio 2.0 AAC:","ddplus-2.0-dash":"\u00c1udio 2.0 E-AC3:","ddplus-5.1-dash":"\u00c1udio 5.1 E-AC3:","dfxp-ls-sdh":"Legenda (dfxp):"}[a];c.appendChild(f);c.appendChild(h);c.appendChild(f.cloneNode());if("dfxp-ls-sdh"===a){var n=document.createDocumentFragment();h=h.cloneNode();h.textContent="Legenda (srt):";n.appendChild(h);n.appendChild(f.cloneNode())}b.forEach(function(b){var a=
document.createElement("a");a.className="quality";if(b.bitrate)a.textContent=b.bitrate+" kbps";else if(a.textContent=b.isForced?"For\u00e7ada":"Normal",!1===b.isImage){var h=document.createElement("a");h.textContent=a.textContent;h.className="quality";h.addEventListener("click",function(a){a.preventDefault();var c=a.target;c.classList.contains("quality")&&(c.classList.remove("quality"),fetch(b.url).then(function(b){return b.text()}).then(function(a){d(N(a),e+"."+k+"."+(b.isForced?"forced.":"")+"srt");
c.classList.add("quality")}))});n.appendChild(h);n.appendChild(document.createTextNode("\u00a0"))}a.href=b.url;c.appendChild(a);c.appendChild(document.createTextNode("\u00a0"))});n&&2<n.children.length&&(c.appendChild(f.cloneNode()),c.appendChild(f.cloneNode()),c.appendChild(n));c.appendChild(f.cloneNode())}function c(){for(var b=u.length-1;0<=b;--b)u[b].style.display="none";document.querySelector('.select-box-content[data-lang="'+w[w.selectedIndex].value+'"]').style.display=""}var e=D(),k=document.createElement("select");
k.id="select-id";var f=document.createDocumentFragment();Object.keys(a).forEach(function(c){var d=document.createElement("option");d.value=c;d.text=c;"pt-BR"===c&&(d.selected="selected");k.add(d);var e=document.createElement("div");e.setAttribute("data-lang",c);e.className="select-box-content";Object.keys(a[c].audios||{}).forEach(function(d){return b(a[c].audios[d],d,e,c)});Object.keys(a[c].subtitles||{}).forEach(function(d){return b(a[c].subtitles[d],d,e,c)});f.appendChild(e)});var m=document.createRange().createContextualFragment('<div id="box">\n\t\t\t<div id="content">\n\t\t\t   <div id="select-box"></div>\n\t\t\t</div>\n\t\t</div>'),
g=m.getElementById("select-box");g.appendChild(k);g.parentNode.insertBefore(f,g.nextSibling);document.body.insertBefore(m,document.body.firstChild);var w=document.getElementById("select-id"),u=document.getElementsByClassName("select-box-content");k.addEventListener("change",c);c()}function K(a,c,b){a.forEach(function(a){a.bcp47&&(c[a.bcp47]||(c[a.bcp47]={}),c[a.bcp47][b]||(c[a.bcp47][b]={}),"ASSISTIVE"!==a.trackType&&a.downloadables&&a.downloadables.forEach(function(d){c[a.bcp47][b][d.contentProfile]||
(c[a.bcp47][b][d.contentProfile]=[]);var e=d.urls[d.id.split(";").pop()];c[a.bcp47][b][d.contentProfile].push("audios"===b?{bitrate:d.bitrate,url:e}:{isForced:a.isForced,isImage:d.isImage,url:e})}))})}function U(a){var c=document.head;if(c){var b=document.createElement("style");b.textContent=a;b.type="text/css";c.appendChild(b);return b}}var R={manifest:"https://www.netflix.com/api/msl/NFCDCH-LX/cadmium/manifest"},x=function(){function a(a,b,d){for(var e=[],h=b;h<d;h+=3)b=(a[h]<<16)+(a[h+1]<<8)+a[h+
2],e.push(c[b>>18&63]+c[b>>12&63]+c[b>>6&63]+c[b&63]);return e.join("")}for(var c=[],b=[],e=0;64>e;++e)c[e]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e],b["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(e)]=e;b[45]=62;b[95]=63;return{toByteArray:function(a){var c;var d=c=a.length;if(0<d%4)throw Error("Invalid string. Length must be a multiple of 4");d="="===a[d-2]?2:"="===a[d-1]?1:0;var e=new Uint8Array(3*c/4-d);var f=0<d?c-4:c;var h=0;for(c=
0;c<f;c+=4){var g=b[a.charCodeAt(c)]<<18|b[a.charCodeAt(c+1)]<<12|b[a.charCodeAt(c+2)]<<6|b[a.charCodeAt(c+3)];e[h++]=g>>16&255;e[h++]=g>>8&255;e[h++]=g&255}2===d?(g=b[a.charCodeAt(c)]<<2|b[a.charCodeAt(c+1)]>>4,e[h++]=g&255):1===d&&(g=b[a.charCodeAt(c)]<<10|b[a.charCodeAt(c+1)]<<4|b[a.charCodeAt(c+2)]>>2,e[h++]=g>>8&255,e[h++]=g&255);return e},fromByteArray:function(b){for(var d=b.length,e=d%3,f="",h=[],g=0,m=d-e;g<m;g+=16383)h.push(a(b,g,g+16383>m?m:g+16383));1===e?(b=b[d-1],f+=c[b>>2],f+=c[b<<
4&63],f+="=="):2===e&&(b=(b[d-2]<<8)+b[d-1],f+=c[b>>10],f+=c[b>>4&63],f+=c[b<<2&63],f+="=");h.push(f);return h.join("")}}}();f.prototype=Object.create(Error.prototype);f.prototype.constructor=f;f.prototype.name="MslException";f.prototype.toString=function(){return"Type: "+this.name+"\nMessage: "+this.message+"\nlineNumber: "+this.lineNumber+"\ncolumnNumber: "+this.columnNumber+"\n\nStack:\n"+this.stack};var v;(function(){var a=indexedDB.open("netflix.player");a.onerror=function(a){console.info("open db error",
a)};a.onsuccess=function(a){a=a.target.result;try{var b=a.transaction(["namedatapairs"]).objectStore("namedatapairs").get("mslstore");b.onerror=function(a){console.info("Error transition")};b.onsuccess=function(a){v=a.target.result.data;v.sequencenumber=JSON.parse(atob(v.masterTokenJSON.tokendata)).sequencenumber}}catch(p){console.error(p)}}})();var Q=function(){function a(a,b){var c=b||a.length;return a.reduce(function(a,b,d){return d<c?a+String.fromCharCode(b):a},"")}for(var c=Object.create(null),
b=0;256>b;++b)c[String.fromCharCode(b)]=b;var e=new TextEncoder;return{compress:function(b){function d(a,b){for(;0<b;){if(t>=f.length)return!1;var c=a;if(b>q)c>>>=b-q,f[t]|=c&255,b-=q,q=8,++t;else{c<<=q-b;c&=255;c>>>=8-q;f[t]|=c&255;q-=b;0===q&&(q=8,++t);break}}return!0}b=e.encode(b);var f=new Uint8Array(b.length),g=Object.create(null),h=b.length,m=[];for(l in c)g[l]=c[l];var l=256;var t=0,q;var p=q=8;for(var r=0;r<h;++r){var v=b[r];m.push(v);var x=a(m);if(!g[x]){m=a(m,m.length-1);if(!d(g[m],p))return null;
0!==l>>p&&++p;g[x]=l++;m=[v]}}return 0<m.length&&!d(g[a(m)],p)?null:f.subarray(0,8>q?t+1:t)}}}(),G=new TextEncoder,S=function(){return{pause:function(){setTimeout(function(){var a=document.querySelector(".player-control-button.player-play-pause");a&&a.classList.contains("icon-player-pause")&&a.click()},2E3)}}}(),F=!1;window.addEventListener("DOMContentLoaded",function(){U("#overlay {\n\t\t\tz-index: 10;\n\t\t\tposition: absolute;\n\t\t\ttop: 0;\n\t\t\tleft: 0;\n\t\t\twidth: 100%;\n\t\t\theight: 100%;\n\t\t\tbackground: #000;\n\t\t\topacity: 0.8;\n\t\t}\n\n\t\t#box {\n\t\t\tborder: 2px solid #edebd7;\n\t\t\tbox-shadow: 1px 1px 1px #6e675f;\n\t\t\tbackground: #423e37;\n\t\t\tz-index: 11;\n\t\t\tcolor: #FFF;\n\t\t\tpadding: 0.5em;\n\t    \tfont-size: 16px;\n\t    \tfont-family: 'Roboto', sans-serif;\n\t    \tfont-weight: bold;\n\t    \tline-height: 1.2em;\n\t\t\tposition: absolute;\n\t    \tmargin: 0 auto;\n\t    \ttop: 50%;\n\t\t\tleft: 50%;\n\t\t\tmargin-left: -150px;\n\t\t\tmargin-top: -150px;\n\t\t\twidth: 300px;\n\t\t\theight: 300px;\n\t\t}\n\n\t\t#select-id {\n\t\t\tcolor: #000;\n\t\t\twidth: 100px;\n\t\t\tpadding: 0.5em;\n\t\t\tmargin: 0.5em;\n\t\t}\n\n\t\t#content {\n\t\t\ttext-align: center;\n\t\t\theight: 300px;\n\t\t}\n\n\t\t.prefix {\n\t\t\tcolor: #e3b23c;\n\t\t}\n\t\t.quality {\n\t\t\ttext-decoration: none;\n\t\t\tcursor: pointer;\n\t\t\tcolor: #edebd7;\n\t\t}\n\n\t\t.quality:hover {\n\t\t\tcolor: #81a094;\n\t\t}");
document.body.addEventListener("keydown",function(a){var c=a.shiftKey,b=a.which;if(a.altKey&&c)switch(b){case 78:console.log("ok");M();return;default:console.log(":)")}F&&a.stopPropagation()},!0)})})();