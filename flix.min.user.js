// ==UserScript==
// @name        Flix
// @version     2.0.1
// @namespace   @XOR
// @description User script para facilitar download de legendas e Ã¡udios na(o) Netflix
// @author      XOR
// @include     https://www.netflix.com/*
// @icon        data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAYAAADimHc4AAAHm0lEQVR4Xu2dbUhUWRjH//fqWGNf+qKGYCsSQn4o6UMfwjeMiqLdom3dJVKpJaVWCCpaet/IldU0jMwXtFZqe3PBgsglC/Nli5DVJAkiIiIMWtkQrMZ8mXuXZ3JsHOfOnTt3TuPoc77ee59zzvM7z3nOPc+595HAJagakIJaO1cOBhDkQcAApiOA/vQlqaoiF0HCMgCRQW5jqFdvg4puSVYORrc97nDvzBQLcChflVsByKHe82nWfkWSlAx3CFMA/Jua3AEJKdOs8TOjOSr+junoSXXtzFQAackfeNoRxtsW094zTw+AKqx6FoyY9p5Jg96TBTAAgQMlqAC67BIejJnr3TcW4Ct58hgZBnB22NiaYY4E5FkUWL7wQjyoABpGJdSPGFOUO64EGSi32hHucuG9CmTZwgyT/dai4scIxfBzZh6YFgBiY2Oxd+9eQ/2oqqrC8+fPHc/8YFGQE/HZClwB5OTkICoqSlN2d3c37t2757hOQ6HEqiDJzaIMNczgzdMCQGJiIi5fvmyo6aWlpbh69arjGRrrZXPtSBwf9K4ASC7J1ypXrlxBWVnZxOVYGThrtWOOodb4f3PIAmhqasLRo0cneh4nAxVWOywAzAAggV9bVOz8QlNRyAJ4+fIlNm/ePGnoOedwswDID/86145k427EsCmELABVVZGeng6bzTbRaeccvlBSJ5yw0SnIKSxKAqoi7cI3vkIWACkqPz8fXV1dk0YdzeHFc+3IHl8F+QuAhOZGqPjeInZVFNIATp8+jYsXL04x+8xwFS1jnxb0ZgB8Z1GwzWV1ZXh+8eGBkAZw584dHDhwwGs3GYAX9ThfxPxZhpLY169fY8OGDQzAB0vzeItZACQ0MzMTg4ODmk1gCxBoASS6oKAADx8+ZAD+WEEgLKCyshLnz59nAMEC0Nrain379jGAYAHo7+/HunXrGECwAFC9a9aswdu3bz02gZ2wYCdM4vfs2YP29nYGYNQKAuGEqc7a2lrU1NQwgGABuH//Pnbv3s0ARAKgXc/ISM+H8gYGBrBq1SoGIBJAT08PkpOTNatYv3493rx5M+U6O+EAOeGGhgZkZWVpStu/fz9aWloYgBErMOKET5w4gSNHjmiKr6+vR0VFBQMQBSA7O9vj3r+zvs7OTuzatYsBiAKQlpaGu3fvIiIiwmMV7969c+yMUqjStbAPCJAPWLFiBerq6pCUlKQpcdOmTXj16hUD8NUKjPgAAkCOduPGjZriDx06hNu3bzMAUQBI+QRBq9B0c+rUKQYgCsDixYtx7tw5TfGPHj3Cjh07GIAoAOHh4Whra4MkeT7CPDQ05DgrpCifj5KwEw6gEx4ZGcH169cRFxenKZVe1l68eDFxnQEEGEBxcTFWrlypKfX48eO4efMmA/BlGjK6CiIL2L59u8cXLmd9tGVRUlLCAEQBSElJQXl5uab4J0+eIDc3lwGIAhAdHQ06mq5VyErorXls7NO3T+wDAuwDSBxtScyfP19T8tatW/H06VMGoGcF/vgAkklngZYvX64pvqioCI2NjQxAFAAKP9LuqFa5ceMGCgsLGYAoAGvXrgXFB7TKs2fPsGXLFgYgCkBCQgJoualV7HY7UlNTQQ6ZnbAAJxwWFoaOjg7N2ABVuW3bNvT29jIAb1bgrxMmmRcuXPAaGzh58iSuXbvGAEQBOHz4sNfYwK1bt3Ds2DEGIAoAbbp5iw3Qhhzdwz5AgA8gkUuXLvUaG6At6YyMDEcY08iX8q7N5Y/0XLRBIUla1TgLnZLzFhug+/Ly8hzfDjAADSsw44RJpF5sgDbt6NsBBiAIgF5soLm5GfHx8QxAyw2YtQC92EBfX5/jVwZsAYIsQC82QNXSgd0FCxZoLgXcf1fDTlhDVe5OmG7Tiw3obYXQdQYwIjumCL0fNnkCQArUiw3oQWAAJgHoxQYYgKAXMadYvdgAAxAMQC82wAAEA9CLDTAAwQB8iQ14g8BO2KQTJuXqxQYYgKAXMadYvdgAAxAMQC82wAAEA9CLDTAAwQB8iQ1oQWAnHAAnTMrViw0wAA8aMLsd7SpSLzbAAAQD0IsNMADBAHyJDXiCMKt9wJ+jMn4fkbBo0SLH6QVvZfXq1ZOC8u73UpKGS5cu6e08TLlOp6irq6s9PjfjT0U0jkqoM5nCxLDGDTww4wH8NSbjzLD5rDlWCRgSkOtpxgP4oAI7P4bhP5N/iC+Yo6DCYNYkXwxhxgMgJXTaJfzy0VwmpTqrHX+Mymgd/2W9L8r15Z5ZAYAUUTosT/zv3xfFuN9TG6lgHlTk2WS8D2BK5FkDgJSWb5Mx4Oc8XmO1g5L4NI/JKA+AT3ECnjUAqMMPxiQU+jmPV1vtWDg+i/08JKNXMe/YqU2zCgB1+LdhGe1+zOOVVgXx48nX+lQJPw3JGPXTmlynt1kHYFAFzgzLsBt0BPkRCmJc/HjTmIR//ADpXm1KuArKRyOyBDWHjMiOhYpsXwBwQmdxNH1I6MwpzcWp35eU5v3pS1JVVW4dTzYqrjGzT7IiSUpGdNvjDteue1y/OSAochEkLOP88qZHig0quiVZOeiufJIcmAW06TbOXgEMIMjsGQADCLIGglz9/76dT8rhTGJGAAAAAElFTkSuQmCC
// @grant       none
// @homepageURL https://gist.github.com/xor10/8f65c1e66a34386e1131f8c28ff6bf64
// @downloadURL https://gist.github.com/xor10/8f65c1e66a34386e1131f8c28ff6bf64/raw/flix.min.user.js
// @updateURL   https://gist.github.com/xor10/8f65c1e66a34386e1131f8c28ff6bf64/raw/flix.min.user.js
// @run-at      document-start
// @noframes
// ==/UserScript==
/* jshint ignore:start */
!(function(){'use strict';var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,g){a!=Array.prototype&&a!=Object.prototype&&(a[b]=g.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+a++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.polyfill=function(a,b,g,l){if(b){g=$jscomp.global;a=a.split(".");for(l=0;l<a.length-1;l++){var f=a[l];f in g||(g[f]={});g=g[f]}a=a[a.length-1];l=g[a];b=b(l);b!=l&&null!=b&&$jscomp.defineProperty(g,a,{configurable:!0,writable:!0,value:b})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function g(a){return a instanceof f?a:new f(function(x,b){x(a)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;b.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};b.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var l=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(a){l(a,
0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var f=a[b];delete a[b];try{f()}catch(F){this.asyncThrow_(F)}}}this.batch_=null};b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var f=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(E){b.reject(E)}};f.prototype.createResolveAndReject_=
function(){function a(a){return function(x){f||(f=!0,a.call(b,x))}}var b=this,f=!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};f.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof f)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};f.prototype.resolveToNonPromiseObj_=function(a){var b=
void 0;try{b=a.then}catch(E){this.reject_(E);return}"function"==typeof b?this.settleSameAsThenable_(b,a):this.fulfill_(a)};f.prototype.reject_=function(a){this.settle_(2,a)};f.prototype.fulfill_=function(a){this.settle_(1,a)};f.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b|"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};f.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=
this.onSettledCallbacks_,b=0;b<a.length;++b)a[b].call(),a[b]=null;this.onSettledCallbacks_=null}};var B=new b;f.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};f.prototype.settleSameAsThenable_=function(a,b){var f=this.createResolveAndReject_();try{a.call(b,f.resolve,f.reject)}catch(F){f.reject(F)}};f.prototype.then=function(a,b){function g(a,b){return"function"==typeof a?function(b){try{l(a(b))}catch(H){x(H)}}:b}var l,x,L=new f(function(a,
b){l=a;x=b});this.callWhenSettled_(g(a,l),g(b,x));return L};f.prototype.catch=function(a){return this.then(void 0,a)};f.prototype.callWhenSettled_=function(a,b){function f(){switch(g.state_){case 1:a(g.result_);break;case 2:b(g.result_);break;default:throw Error("Unexpected state: "+g.state_);}}var g=this;null==this.onSettledCallbacks_?B.asyncExecute(f):this.onSettledCallbacks_.push(function(){B.asyncExecute(f)})};f.resolve=g;f.reject=function(a){return new f(function(b,f){f(a)})};f.race=function(a){return new f(function(b,
f){for(var l=$jscomp.makeIterator(a),x=l.next();!x.done;x=l.next())g(x.value).callWhenSettled_(b,f)})};f.all=function(a){var b=$jscomp.makeIterator(a),l=b.next();return l.done?g([]):new f(function(a,f){function x(b){return function(f){y[b]=f;A--;0==A&&a(y)}}var y=[],A=0;do y.push(void 0),A++,g(l.value).callWhenSettled_(x(y.length-1),f),l=b.next();while(!l.done)})};return f},"es6","es3");
$jscomp.executeAsyncGenerator=function(a){function b(b){return a.next(b)}function g(b){return a.throw(b)}return new Promise(function(l,f){function B(a){a.done?l(a.value):Promise.resolve(a.value).then(b,g).then(B,f)}B(a.next())})};$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(a){var b=function(){};b.prototype=a;return new b};$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(g){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;
$jscomp.inherits=function(a,b){a.prototype=$jscomp.objectCreate(b.prototype);a.prototype.constructor=a;if($jscomp.setPrototypeOf){var g=$jscomp.setPrototypeOf;g(a,b)}else for(g in b)if("prototype"!=g)if(Object.defineProperties){var l=Object.getOwnPropertyDescriptor(b,g);l&&Object.defineProperty(a,g,l)}else a[g]=b[g];a.superClass_=b.prototype};$jscomp.arrayFromIterator=function(a){for(var b,g=[];!(b=a.next()).done;)g.push(b.value);return g};
$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};
(function(a,b){function g(){return $jscomp.executeAsyncGenerator(function(){function a(a,c,d){for(;;)switch(e){case 0:if(!v){e=1;break}e=-1;return{value:v,done:!0};case 1:return e=-1,{value:new Promise(function(a,c){var d=indexedDB.open("netflix.player");d.onerror=function(a){c(new G("Erro ao abrir BD",this.result))};d.onsuccess=function(d){d=d.target.result;try{var e=d.transaction(["namedatapairs"]).objectStore("namedatapairs").get("mslstore");e.onerror=function(a){c(new G("Erro ao obter objeto do BD",
this.result))};e.onsuccess=function(c){v=c.target.result.data;v.sequencenumber=JSON.parse(atob(v.masterTokenJSON.tokendata)).sequencenumber;a(v)}}catch(I){c(new G("Erro ao iniciar transa\u00e7\u00e3o",I))}}}),done:!0};default:return{value:void 0,done:!0}}}var e=0,d={next:function(c){return a(0,c,void 0)},throw:function(c){return a(1,void 0,c)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();d[Symbol.iterator]=function(){return this};return d}())}function l(a,
e){var c={headers:{"Content-Type":"text/plain"},credentials:"include"};Object.keys(e||{}).forEach(function(a){"headers"===a?Object.keys(headers).forEach(function(a){return c.headers[a]=e.headers[a]}):c[a]=e[a]});c.method="POST";return fetch(a,c).then(function(a){return a.text()})}function f(a){return $jscomp.executeAsyncGenerator(function(){function c(c,e,k){for(;;)switch(d){case 0:return d=1,{value:crypto.subtle.sign({name:"HMAC"},v.hmacKey,Q.encode(a)).then(function(a){return new Uint8Array(a)}),
done:!1};case 1:if(1!=c){d=2;break}d=-1;throw k;case 2:return b=h=e,d=-1,{value:C.fromByteArray(b),done:!0};default:return{value:void 0,done:!0}}}var d=0,b,h,k={next:function(a){return c(0,a,void 0)},throw:function(a){return c(1,void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();k[Symbol.iterator]=function(){return this};return k}())}function B(a){var c=new Uint8Array(a);for(--a;0<=a;--a)c[a]=256*Math.random();return c}function x(a){return $jscomp.executeAsyncGenerator(function(){function c(c,
e,m){for(;;)switch(d){case 0:return n=B(16),k={keyid:v.esn+"_"+v.sequencenumber,sha256:"AA==",iv:C.fromByteArray(n)},d=1,{value:crypto.subtle.encrypt({name:"AES-CBC",iv:n},v.encryptionKey,Q.encode(a)).then(function(a){return new Uint8Array(a)}),done:!1};case 1:if(1!=c){d=2;break}d=-1;throw m;case 2:return b=h=e,k.ciphertext=C.fromByteArray(b),d=-1,{value:JSON.stringify(k),done:!0};default:return{value:void 0,done:!0}}}var d=0,b,h,k,n,m={next:function(a){return c(0,a,void 0)},throw:function(a){return c(1,
void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();m[Symbol.iterator]=function(){return this};return m}())}function L(){return $jscomp.executeAsyncGenerator(function(){function a(a,c,h){for(;;)switch(e){case 0:return e=1,{value:crypto.subtle.exportKey("spki",v.keyxPublicKey).then(function(a){return new Uint8Array(a)}),done:!1};case 1:if(1!=a){e=2;break}e=-1;throw h;case 2:return d=b=c,e=-1,{value:C.fromByteArray(d),done:!0};default:return{value:void 0,
done:!0}}}var e=0,d,b,h={next:function(c){return a(0,c,void 0)},throw:function(c){return a(1,void 0,c)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();h[Symbol.iterator]=function(){return this};return h}())}function E(a){return $jscomp.executeAsyncGenerator(function(){function c(c,e,m){for(;;)switch(d){case 0:return n=Math.random()*Math.pow(2,52),h=k={sender:v.esn,capabilities:{languages:[],compressionalgos:a&&(Array.isArray(a)?a:[a])||[]},renewable:!0,messageid:n},
d=1,{value:L(),done:!1};case 1:if(1!=c){d=2;break}d=-1;throw m;case 2:b=e;h.keyrequestdata=[{scheme:"ASYMMETRIC_WRAPPED",keydata:{publickey:b,mechanism:"JWK_RSA",keypairid:"rsaKeypairId"}}];if(v.userList&&v.userList.length){c=[];e=$jscomp.makeIterator(v.userList[0].serviceTokenJSONList);for(m=e.next();!m.done;m=e.next())c.push(m.value);k.useridtoken=v.userList[0].userIdTokenJSON;k.servicetokens=c}k.userauthdata={scheme:"NETFLIXID",authdata:{}};d=-1;return{value:{id:n,header:JSON.stringify(k)},done:!0};
default:return{value:void 0,done:!0}}}var d=0,b,h,k,n,m={next:function(a){return c(0,a,void 0)},throw:function(a){return c(1,void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();m[Symbol.iterator]=function(){return this};return m}())}function F(a){return $jscomp.executeAsyncGenerator(function(){function c(c,e,t){for(;;)switch(d){case 0:return d=1,{value:E(),done:!1};case 1:if(1!=c){d=2;break}d=-1;throw t;case 2:return M=aa=e,d=3,{value:x(M.header),done:!1};
case 3:if(1!=c){d=4;break}d=-1;throw t;case 4:return l=w=e,R=v.masterTokenJSON,u=btoa(l),d=5,{value:f(l),done:!1};case 5:if(1!=c){d=6;break}d=-1;throw t;case 6:return g=e,r={mastertoken:R,headerdata:u,signature:g},I='[{},{"headers":{},"path":"/cbp/cadmium-13","payload":{"data":"'+JSON.stringify(a).replace(/"/g,'\\"')+'"},"query":""}]',q=C.fromByteArray(ba.compress(I)),p={messageid:M.id,data:q,compressionalgo:"LZW",sequencenumber:1,endofmsg:!0},d=7,{value:x(JSON.stringify(p)),done:!1};case 7:if(1!=
c){d=8;break}d=-1;throw t;case 8:return m=Z=e,n=btoa(m),d=9,{value:f(m),done:!1};case 9:if(1!=c){d=10;break}d=-1;throw t;case 10:return k=e,h={payload:n,signature:k},b=JSON.stringify(r)+JSON.stringify(h),d=-1,{value:b,done:!0};default:return{value:void 0,done:!0}}}var d=0,b,h,k,n,m,Z,p,q,I,r,g,u,R,l,w,M,aa,y={next:function(a){return c(0,a,void 0)},throw:function(a){return c(1,void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();y[Symbol.iterator]=function(){return this};
return y}())}function X(a){return $jscomp.executeAsyncGenerator(function(){function c(c,e,t){for(;;)switch(d){case 0:return d=1,{value:g(),done:!1};case 1:if(1!=c){d=2;break}d=-1;throw t;case 2:return p={method:"manifest",lookupType:"PREPARE",viewableIds:Array.isArray(a)?a:[a],profiles:"playready-h264bpl30-dash playready-h264mpl30-dash heaac-2-dash ddplus-2.0-dash ddplus-atmos-dash ddplus-5.1-dash dd-5.1-elem dfxp-ls-sdh".split(" "),drmSystem:"widevine",appId:"14673889385265",sessionParams:{pinCapableClient:!1,
uiplaycontext:"null"},sessionId:"14673889385265",trackId:0,flavor:"PRE_FETCH",secureUrls:!0,supportPreviewContent:!0,forceClearStreams:!1,languages:["en-US"],clientVersion:"4.0004.899.011",uiVersion:"akira"},d=3,{value:F(p),done:!1};case 3:if(1!=c){d=4;break}d=-1;throw t;case 4:return m=f=e,d=5,{value:l(ca.manifest,{body:m}),done:!1};case 5:if(1!=c){d=6;break}d=-1;throw t;case 6:k=n=e;d=7;c=Y;t=k;for(var q=[],r=t.indexOf('payload":"');~r;)r+=10,e=t.indexOf('"',r),q.push(t.slice(r,e)),r=t.indexOf('payload":"',
e);return{value:c(q),done:!1};case 7:if(1!=c){d=8;break}d=-1;throw t;case 8:return b=h=e,d=-1,{value:b,done:!0};default:return{value:void 0,done:!0}}}var d=0,b,h,k,n,m,f,p,q={next:function(a){return c(0,a,void 0)},throw:function(a){return c(1,void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();q[Symbol.iterator]=function(){return this};return q}())}function Y(a){return $jscomp.executeAsyncGenerator(function(){function c(c,e,t){for(;;)switch(d){case 0:r=
"",g=$jscomp.makeIterator(a),q=g.next();case 1:if(q.done){d=3;break}p=q.value;f=JSON.parse(atob(p));m=C.toByteArray(f.iv);n=C.toByteArray(f.ciphertext);d=4;return{value:crypto.subtle.decrypt({name:"AES-CBC",iv:m},v.encryptionKey,n).then(function(a){return new Uint8Array(a)}),done:!1};case 4:if(1!=c){d=5;break}d=-1;throw t;case 5:h=k=e,b=JSON.parse((new TextDecoder).decode(h)),r+=atob(b.data);case 2:q=g.next();d=1;break;case 3:return r=JSON.parse(r)[1].payload.data,r=atob(r),d=-1,{value:JSON.parse(r),
done:!0};default:return{value:void 0,done:!0}}}var d=0,b,h,k,n,m,f,p,q,g,r,l={next:function(a){return c(0,a,void 0)},throw:function(a){return c(1,void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();l[Symbol.iterator]=function(){return this};return l}())}function y(a,e){if(a){var c=a;Array.isArray(c)?c=!0:(c=Object.prototype.toString.call(c),c="[object HTMLCollection]"===c||"[object NodeList]"===c?!0:!1);c||(a=[a]);for(c=a.length-1;0<=c;--c)a[c].style.display=
e}}function A(a){y(a,"none")}function w(a,e){e=void 0===e?document:e;return e.querySelector(a)}function H(a,e){e=void 0===e?document:e;return e.querySelectorAll(a)}function S(a,e){a=""+a;return"0".repeat(Math.max(0,e-a.length))+a}function da(a){var c=function(a,c){a=""+a;return"0".repeat(Math.max(0,c-a.length))+a},b=function(a){var b=Math.round(~~a.substr(-8,7)/1E4);a=~~a.slice(0,-8);var e=a%60,d=Math.floor(a/60%60);return c(Math.floor(a/3600),2)+":"+c(d,2)+":"+c(e,2)+","+c(b,3)},t=(new DOMParser).parseFromString(a,
"text/xml"),h=[];a=t.getElementsByTagName("style");for(var k=a.length-1;0<=k;--k){var n=a[k];"italic"===n.getAttribute("tts:fontStyle")&&h.push(n.getAttribute("xml:id"))}a=function(a,c){return~h.indexOf(c.getAttribute("style"))?"<i>"+a+"</i>":a};t=t.getElementsByTagName("p");k=t.length;n="";for(var m=0,f=1;m<k;){for(var p=t[m++],q=p.childNodes,g=q.length,r="",l=0;l<g;++l){var u=q[l];"br"===u.tagName?r+="\n":u.textContent&&(r="span"===u.tagName?r+a(u.textContent,u):r+u.textContent)}r&&(q=b(p.getAttribute("begin")),
g=b(p.getAttribute("end")),r=a(r,p),n+=f++ +"\n"+q+" --\x3e "+g+"\n"+r.replace(/<\/i>\n<i>/g,"\n")+"\n\n")}return n}function ea(a){if((a=w(".video-title > div")||w(".player-status"))&&1<a.children.length){a=a.children;var c=/(\d+):.+?(\d+)$/.exec(a[1].textContent);return a[0].textContent+".S"+S(c[1],2)+"E"+S(c[2],2)}return a&&a.textContent||""}function fa(a,b){var c=URL.createObjectURL(a);a=document.createElement("a");a.style.display="none";a.download=b;a.href=c;setTimeout(function(){return URL.revokeObjectURL(c)},
1E4);document.body.appendChild(a);a.click();a.remove()}function ha(a,b){for(var c=0,e=a.length;c<e;++c)a[c].addEventListener("click",b)}function T(a,b){return b.includes(a)?a:b[0]}function U(a,b){for(var c="pt-BR"===navigator.language?"For\u00e7ada":"Forced",e=0,h=a.length;e<h;++e){var k=a[e],n=k.bcp47;if(n){b[n]||(b[n]={});n=b[n];var m=k.downloadables;if("AUDIO"===k.type){k="ASSISTIVE"===k.trackType?"-ad":"";for(var f=m.length-1;0<=f;--f){var p=m[f],q=p.contentProfile+k,g=p.id.split(";")[1];p={bitrate:p.bitrate,
type:"AUDIO",text:p.bitrate+"kbps",downloadUrl:p.urls[g]};if(!n[q])n[q]=[];else if(n[q][0].bitrate<p.bitrate){n[q].unshift(p);continue}n[q].push(p)}}else"TEXT"===k.type&&m&&(f=m[0],m=f.contentProfile,q=f.id.split(";")[1],n[m]||(n[m]=[]),p="CLOSEDCAPTIONS"===k.trackType?" [CC]":"",k={isForced:k.isForced,type:"SUBTITLES",isCC:""!==p,text:k.isForced?c+p:"Normal"+p,downloadUrl:f.urls[q]},k.isForced?n[m].push(k):n[m].unshift(k))}}}function ia(a){var c={};if(!1===a.success)throw new N(a.result.data.cause.value.result.errorDisplayMessage,
a.result.data.cause.value);var d=a.result.viewables[0];U(d.audioTracks,c);U(d.textTracks,c);var f={"ddplus-atmos-dash":0,"ddplus-atmos-dash-ad":1,"dd-5.1-elem":2,"dd-5.1-elem-ad":3,"ddplus-5.1-dash":4,"ddplus-5.1-dash-ad":5,"ddplus-2.0-dash":6,"ddplus-2.0-dash-ad":7,"heaac-2-dash":8,"heaac-2-dash-ad":9,"dfxp-ls-sdh":10},h=Object.keys(c),k={"ddplus-atmos-dash":"E-AC-3 5.1 ATMOS:","dd-5.1-elem":"AC-3 5.1:","ddplus-5.1-dash":"E-AC-3 5.1:","ddplus-2.0-dash":"E-AC-3 2.0:","heaac-2-dash":"AAC 2.0:","dfxp-ls-sdh":"pt-BR"===
navigator.language?"Legendas:":"Subtitles:"};Object.keys(k).forEach(function(a){a.startsWith("dfxp")||(k[a+"-ad"]=k[a].replace(":"," [AD]:"))});a=document.createElement("section");a.id="flix-manifest";a.setAttribute("data-movieid",d.movieId);a.innerHTML='\n        <div class="flix-middle">\n          <div class="flix-select">\n          <select name="flix-lang" id="flix-lang">\n            '+h.map(function(a){return'<option value="'+a+'">'+a+"</option>"}).join("")+'\n          </select>\n          </div>\n          <div class="flix-select">\n          <select name="flix-subtitle-type" id="flix-subtitle-type">\n            <option value="SRT">SRT</option>\n            <option value="DFXP">DFXP</option>\n          </select>\n          </div>\n          <div class="flix-select">\n          <select name="flix-charset" id="flix-charset">\n            <option value="UTF8">UTF-8</option>\n            <option value="UTF8B">UTF-8 BOM</option>\n            <option value="ANSI">ANSI</option>\n          </select>\n          </div>\n        </div>\n        '+
h.map(function(a){return'<div data-lang="'+a+'" class="flix-content">\n        '+Object.keys(c[a]).sort(function(a,c){return f[a]-f[c]}).map(function(b){return"<ul><li>"+k[b]+"</li>\n          "+c[a][b].map(function(a){return'<li><a data-type="'+a.type+'" '+("SUBTITLES"===a.type?'data-isforced="'+a.isForced+'" data-iscc="'+a.isCC+'"':"")+' href="'+a.downloadUrl+'">'+a.text+"</a></li>"}).join("")+"\n          </ul>"}).join("")+"\n        </div>\n        "}).join("")+"\n        ";var n=w("#flix-lang",
a),m=w("#flix-subtitle-type",a),g=w("#flix-charset",a),p=H(".flix-content",a),q=Object.create(null),l=ea()||"subtitle";ha(H('a[data-type="SUBTITLES"]',a),function(a){a.preventDefault();var c="true"===this.getAttribute("data-iscc"),d="true"===this.getAttribute("data-isforced"),e=n.value,k=g.value,h=m.value;fetch(this.href).then(function(a){if(!a.ok)throw Error(a.statusText);return"DFXP"===h?a.blob():a.text()}).then(function(a){if(a instanceof Blob){var b=a;a="dfxp"}else{a=da(a);a=a.replace(/(\r)?\n/g,
"\r\n");b=[];switch(k.toUpperCase()){case "ANSI":for(var h=new Uint8Array(a.length),m=0,f=a.length;m<f;++m){var n=a.charCodeAt(m);h[m]=256>n?n:37}b.push(h);break;case "UTF8B":b.push("\ufeff");default:b.push(a)}b=new Blob(b,{type:"application/octet-stream"});a="srt"}fa(b,""+l+(c?".[CC]":"")+"."+e+(d?".forced":"")+"."+a)}).catch(b.error)});m.addEventListener("change",function(){g.disabled="DFXP"===this.value?"disabled":"";localStorage.setItem("flix-subtitle-type",this.value)});g.addEventListener("change",
function(){localStorage.setItem("flix-charset",this.value)});n.value=localStorage.getItem("flix-lang")||"en";for(d=p.length-1;0<=d;--d)h=p[d],q[h.getAttribute("data-lang")]=h,h.style.display="none";if(d=q[n.value])d.style.display="";n.addEventListener("change",function(){localStorage.setItem("flix-lang",this.value);A(p);q[this.value].style.display=""});m.value=T(localStorage.getItem("flix-subtitle-type"),["SRT","DFXP"]);g.value=T(localStorage.getItem("flix-charset"),["UTF8","UTF8B","ANSI"]);d=new Event("change");
m.dispatchEvent(d);g.dispatchEvent(d);return a}function J(a){return"none"===a.style.display}function ja(){return $jscomp.executeAsyncGenerator(function(){function a(a,c,q){for(;;)switch(e){case 0:if(J(z)){e=1;break}A(z);e=-1;return{value:void 0,done:!0};case 1:if(J(K)){e=2;break}V.pause();y(z,"");e=-1;return{value:void 0,done:!0};case 2:p=/^\/watch\/(\d{4,})$/.exec(location.pathname);try{if(!p){e=5;break}V.pause();m=p[1];if(D.getAttribute("data-movieid")!==m){e=6;break}y(z,"");e=-1;return{value:void 0,
done:!0}}catch(u){g=u;e=3;break}case 6:try{return D.remove(),y(z,""),y(K,""),e=7,{value:X([parseInt(m)]),done:!1}}catch(u){g=u;e=3;break}case 7:try{if(1!=a){e=8;break}e=-1;throw q;}catch(u){g=u;e=3;break}case 8:try{k=n=c,D=ia(k),O.appendChild(D)}catch(u){g=u;e=3;break}case 5:try{e=4;break}catch(u){g=u;e=3;break}case 3:h=g,b.error(h),f=document.createElement("section"),f.setAttribute("data-movieid","0"),f.id="flix-manifest",d=document.createElement("div"),d.className="flix-error",d.textContent=h.message,
f.appendChild(d),D=f,O.appendChild(D);case 4:A(K),e=-1;default:return{value:void 0,done:!0}}}var e=0,d,f,h,k,n,m,g,p,q={next:function(c){return a(0,c,void 0)},throw:function(c){return a(1,void 0,c)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();q[Symbol.iterator]=function(){return this};return q}())}function ka(){document.body.addEventListener("keydown",function(a){J(z)||a.stopPropagation();a.altKey&&a.shiftKey&&78===a.which&&ja()},!0);document.body.addEventListener("keydown",
function(a){27!==a.which||J(z)||(A(z),a.stopPropagation())},!0)}function la(){var a=document.createElement("div");a.id="flix-overlay";a.style.display="none";a.innerHTML='\n        <div id="flix-dialog">\n            <div class="flix-header">\n                <div class="text" title="'+P+" v"+W+'"><img src="'+ma+'"></img>'+P+' <span class="small-text">v'+W+'</span></div>\n                <div class="small-text author">by '+na+'</div>\n            </div>\n            <hr>\n            <div id="flix-loading" style="display: none"><div class="flix-bar"></div></div>\n            <span id="flix-dialog-close" title="'+
("pt-BR"===navigator.language?"Fechar":"Close")+'">\u00d7</span>\n            <section data-movieid="-1" id="flix-manifest"></section>\n        </div>\n        ';document.body.appendChild(a);z=w.id("flix-overlay");K=w.id("flix-loading");D=w.id("flix-manifest");O=w.id("flix-dialog");w.id("flix-dialog-close").addEventListener("click",function(){A(z)})}if(a.top===a.self){a=b.info.script;var P=a.name,W=a.version;a=b.info.scriptMetaStr;var na=/@author\s*(.+)/.exec(a)[1],ma=/@icon\s*(.+)/.exec(a)[1],oa=
"["+P+"]";["log","error"].forEach(function(a){b[a]=function(b){for(var c=[],e=0;e<arguments.length;++e)c[e-0]=arguments[e];console[a].apply(null,[].concat([oa],$jscomp.arrayFromIterable(c)))}});b.log("Loading...");var ca={manifest:"https://www.netflix.com/api/msl/NFCDCH-LX/cadmium/manifest"},C=function(){function a(a,c,d){for(var e=[],f=c;f<d;f+=3)c=(a[f]<<16)+(a[f+1]<<8)+a[f+2],e.push(b[c>>18&63]+b[c>>12&63]+b[c>>6&63]+b[c&63]);return e.join("")}for(var b=[],d=[],f=0;64>f;++f)b[f]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[f],
d["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(f)]=f;d[45]=62;d[95]=63;return{toByteArray:function(a){var b;var c=b=a.length;if(0<c%4)throw Error("Invalid string. Length must be a multiple of 4");c="="===a[c-2]?2:"="===a[c-1]?1:0;var e=new Uint8Array(3*b/4-c);var f=0<c?b-4:b;var g=0;for(b=0;b<f;b+=4){var h=d[a.charCodeAt(b)]<<18|d[a.charCodeAt(b+1)]<<12|d[a.charCodeAt(b+2)]<<6|d[a.charCodeAt(b+3)];e[g++]=h>>16&255;e[g++]=h>>8&255;e[g++]=h&255}2===c?(h=d[a.charCodeAt(b)]<<
2|d[a.charCodeAt(b+1)]>>4,e[g++]=h&255):1===c&&(h=d[a.charCodeAt(b)]<<10|d[a.charCodeAt(b+1)]<<4|d[a.charCodeAt(b+2)]>>2,e[g++]=h>>8&255,e[g++]=h&255);return e},fromByteArray:function(c){for(var e=c.length,d=e%3,f="",g=[],h=0,q=e-d;h<q;h+=16383)g.push(a(c,h,h+16383>q?q:h+16383));1===d?(c=c[e-1],f+=b[c>>2],f+=b[c<<4&63],f+="=="):2===d&&(c=(c[e-2]<<8)+c[e-1],f+=b[c>>10],f+=b[c>>4&63],f+=b[c<<2&63],f+="=");g.push(f);return g.join("")}}}(),G=function(a,b){a=Error.call(this,a);this.message=a.message;"stack"in
a&&(this.stack=a.stack);this._error=b};$jscomp.inherits(G,Error);$jscomp.global.Object.defineProperties(G.prototype,{error:{configurable:!0,enumerable:!0,get:function(){return this._error}}});var v,ba=function(){function a(a,b){var c=b||a.length;return a.reduce(function(a,b,d){return d<c?a+String.fromCharCode(b):a},"")}for(var b=Object.create(null),d=0;256>d;++d)b[String.fromCharCode(d)]=d;var f=new TextEncoder;return{compress:function(c){function d(a,b){for(;0<b;){if(l>=e.length)return!1;var c=a;
if(b>r)c>>>=b-r,e[l]|=c&255,b-=r,r=8,++l;else{c<<=r-b;c&=255;c>>>=8-r;e[l]|=c&255;r-=b;0===r&&(r=8,++l);break}}return!0}c=f.encode(c);var e=new Uint8Array(c.length),g=Object.create(null),h=c.length,p=[];for(q in b)g[q]=b[q];var q=256;var l=0,r;var t=r=8;for(var u=0;u<h;++u){var v=c[u];p.push(v);var w=a(p);if(!g[w]){p=a(p,p.length-1);if(!d(g[p],t))return null;0!==q>>t&&++t;g[w]=q++;p=[v]}}return 0<p.length&&!d(g[a(p)],t)?null:e.subarray(0,8>r?l+1:l)}}}(),Q=new TextEncoder;w.id=function(a,b){b=void 0===
b?document:b;return b.getElementById(a)};w.waitDOM=function(){return new Promise(function(a){"loading"!==document.readyState?a():document.addEventListener("DOMContentLoaded",a)})};var V=function(){return{pause:function(){var a=w(".button-nfplayerPause")||w(".icon-player-pause");a&&a.click()}}}(),N=function(a,b){a=Error.call(this,a);this.message=a.message;"stack"in a&&(this.stack=a.stack);this.name="ManifestError";this._cause=b};$jscomp.inherits(N,Error);$jscomp.global.Object.defineProperties(N.prototype,
{cause:{configurable:!0,enumerable:!0,get:function(){return this._cause}}});var z,K,D,O;(function(){return $jscomp.executeAsyncGenerator(function(){function a(a,c,d){for(;;)switch(b){case 0:return a=document.createElement("style"),a.textContent='\n    @font-face {\n    font-family: \'eu-bold\';\n    font-weight: normal;\n    font-style: normal;\n    src: url(\'//flixscript.github.io/font/eu.woff2\') format(\'woff2\');\n}\n#flix-overlay {\n    background-color: rgba(46, 46, 46, .9);\n    margin: 0;\n    padding: 0;\n    border: 0;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    position: fixed;\n    overflow: hidden;\n    z-index: 3000;\n}\n#flix-dialog {\n    font-family: "eu-bold";\n    font-size: 16px;\n    background: none repeat scroll 0 0 padding-box #242223;\n    box-shadow: 0 0 10px #000;\n    box-sizing: border-box;\n    color: #fff;\n    top: 50%;\n    left: 50%;\n    position: absolute;\n    margin: -150px 0px 0px -330px;\n    padding: 7px;\n    width: 580px;\n    height: 320px;\n    display: flex;\n    flex-direction: column;\n    line-height: 1;\n}\n#flix-dialog section, .flix-content ul {\n    margin: 0;\n    padding: 0;\n    border: 0;\n}\n\n#flix-dialog hr {\n    margin-left: 0;\n    margin-right: 0;\n    border: 0;\n    background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(256, 245, 254, 0.75), rgba(0, 0, 0, 0));\n    height: 1px;\n}\n\n.flix-header {\n    display: flex;\n    line-height: 32px;\n    margin: 5px 5px 0;\n}\n\n.flix-header img {\n    margin-right: 6px;\n    height: 26px;\n    width: 26px;\n    vertical-align: sub;\n}\n\n.flix-header .text {\n    font-size: 23px;\n    color: #bd0c0c;\n    flex-grow: 1;\n    text-align: center;\n}\n.flix-header .small-text {\n    font-size: 9px;\n    color: #746D6D;\n    vertical-align: middle;\n}\n\n.flix-header .author {\n    text-align: right;\n}\n\n#flix-dialog-close {\n    position: absolute;\n    top: 5px;\n    right: 5px;\n    line-height: 12px;\n    text-decoration: none;\n    cursor: pointer;\n}\n\n.flix-middle {\n    display: flex;\n    justify-content: center;\n}\n\n#flix-dialog label {\n    line-height: 22px;\n    font-size: 13px;\n}\n\n#flix-dialog select {\n    background-color: #272525;\n    border: 1px solid #120202;\n    border-radius: 3px;\n    color: #fff;\n    cursor: pointer;\n    margin-left: 3px;\n    font-family: "eu-bold";\n    font-size: 12px;\n    outline: 0;\n    -webkit-appearance: none;\n    -moz-appearance: none;\n    appearance: none;\n    padding: 3px 24px;\n}\n\n#flix-dialog select:disabled {\n    opacity: 0.3;\n    cursor: not-allowed;\n}\n\n.flix-select {\n    position: relative;\n}\n\n.flix-select:after {\n    content: ">";\n    color: #FFF;\n    -webkit-transform: rotate(90deg);\n    -moz-transform: rotate(90deg);\n    transform: rotate(90deg);\n    right: 11px;\n    top: 5px;\n    font-size: 11px;\n    position: absolute;\n}\n\n#flix-dialog a {\n    color: #b7a8a8;\n    text-decoration: none;\n}\n\n#flix-dialog a:hover {\n    color: #e93e30;\n}\n\n.flix-content {\n    margin: 24px 0 0 48px;\n}\n.flix-content ul, .flix-content li {\n    list-style: none;\n}\n.flix-content ul {\n    display: flex;\n    flex-direction: row;\n    margin-top: 10px;\n}\n.flix-content li:first-child {\n    width: 150px;\n}\n.flix-content li {\n    margin-left: 3px;\n}\n.flix-content li:not(:nth-child(1)) + li:before {\n    content: " | ";\n}\n.flix-item {\n    margin-top: 5px;\n}\n#flix-loading {\n  position: relative;\n  margin-bottom: 5px;\n  width: 100%;\n  height: 12px;\n  background-color: #3b3a38;\n  border-radius: 4px;\n}\n.flix-bar {\n  content: "";\n  display: inline;\n  position: absolute;\n  width: 0;\n  height: 100%;\n  left: 50%;\n  text-align: center;\n  background-color: #e9250a;\n  border-radius: 4px;\n  animation: floading 4s linear infinite;\n}\n@keyframes floading {\n    from {\n        left: 50%;\n        width: 0;\n    }\n    to {\n        left: 0;\n        width: 100%;\n    }\n}\n\n.flix-error {\n    text-align: center;\n    line-height: 30px;\n    background-color: brown;\n}',
a.type="text/css",(document.head||document.documentElement).appendChild(a),b=1,{value:w.waitDOM(),done:!1};case 1:if(1!=a){b=2;break}b=-1;throw d;case 2:la(),ka(),b=-1;default:return{value:void 0,done:!0}}}var b=0,d={next:function(b){return a(0,b,void 0)},throw:function(b){return a(1,void 0,b)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();d[Symbol.iterator]=function(){return this};return d}())})()}})(window,"undefined"!==typeof GM&&GM||{info:GM_info});}).call(window);
/* jshint ignore:end */