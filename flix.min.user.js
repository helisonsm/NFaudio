// ==UserScript==
// @name        Flix
// @version     2.0.2
// @namespace   @XOR
// @description User script para facilitar download de legendas e Ã¡udios na(o) Netflix
// @author      XOR
// @include     https://www.netflix.com/*
// @icon        data:image/png;base64,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
// @grant       none
// @homepageURL https://gist.github.com/xor10/8f65c1e66a34386e1131f8c28ff6bf64
// @downloadURL https://gist.github.com/xor10/8f65c1e66a34386e1131f8c28ff6bf64/raw/flix.min.user.js
// @updateURL   https://gist.github.com/xor10/8f65c1e66a34386e1131f8c28ff6bf64/raw/flix.min.user.js
// @run-at      document-start
// @noframes
// ==/UserScript==
/* jshint ignore:start */
!(function(){'use strict';var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,g){a!=Array.prototype&&a!=Object.prototype&&(a[b]=g.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+a++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.polyfill=function(a,b,g,h){if(b){g=$jscomp.global;a=a.split(".");for(h=0;h<a.length-1;h++){var e=a[h];e in g||(g[e]={});g=g[e]}a=a[a.length-1];h=g[a];b=b(h);b!=h&&null!=b&&$jscomp.defineProperty(g,a,{configurable:!0,writable:!0,value:b})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function g(a){return a instanceof e?a:new e(function(w,b){w(a)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;b.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};b.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var h=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(a){h(a,
0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var e=a[b];delete a[b];try{e()}catch(H){this.asyncThrow_(H)}}}this.batch_=null};b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var e=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(G){b.reject(G)}};e.prototype.createResolveAndReject_=
function(){function a(a){return function(w){e||(e=!0,a.call(b,w))}}var b=this,e=!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};e.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof e)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};e.prototype.resolveToNonPromiseObj_=function(a){var b=
void 0;try{b=a.then}catch(G){this.reject_(G);return}"function"==typeof b?this.settleSameAsThenable_(b,a):this.fulfill_(a)};e.prototype.reject_=function(a){this.settle_(2,a)};e.prototype.fulfill_=function(a){this.settle_(1,a)};e.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b|"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=
this.onSettledCallbacks_,b=0;b<a.length;++b)a[b].call(),a[b]=null;this.onSettledCallbacks_=null}};var x=new b;e.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};e.prototype.settleSameAsThenable_=function(a,b){var e=this.createResolveAndReject_();try{a.call(b,e.resolve,e.reject)}catch(H){e.reject(H)}};e.prototype.then=function(a,b){function g(a,b){return"function"==typeof a?function(b){try{h(a(b))}catch(p){w(p)}}:b}var h,w,M=new e(function(a,
b){h=a;w=b});this.callWhenSettled_(g(a,h),g(b,w));return M};e.prototype.catch=function(a){return this.then(void 0,a)};e.prototype.callWhenSettled_=function(a,b){function e(){switch(g.state_){case 1:a(g.result_);break;case 2:b(g.result_);break;default:throw Error("Unexpected state: "+g.state_);}}var g=this;null==this.onSettledCallbacks_?x.asyncExecute(e):this.onSettledCallbacks_.push(function(){x.asyncExecute(e)})};e.resolve=g;e.reject=function(a){return new e(function(b,e){e(a)})};e.race=function(a){return new e(function(b,
e){for(var h=$jscomp.makeIterator(a),w=h.next();!w.done;w=h.next())g(w.value).callWhenSettled_(b,e)})};e.all=function(a){var b=$jscomp.makeIterator(a),h=b.next();return h.done?g([]):new e(function(a,e){function w(b){return function(e){x[b]=e;A--;0==A&&a(x)}}var x=[],A=0;do x.push(void 0),A++,g(h.value).callWhenSettled_(w(x.length-1),e),h=b.next();while(!h.done)})};return e},"es6","es3");
$jscomp.executeAsyncGenerator=function(a){function b(b){return a.next(b)}function g(b){return a.throw(b)}return new Promise(function(h,e){function x(a){a.done?h(a.value):Promise.resolve(a.value).then(b,g).then(x,e)}x(a.next())})};$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(a){var b=function(){};b.prototype=a;return new b};$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(g){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;
$jscomp.inherits=function(a,b){a.prototype=$jscomp.objectCreate(b.prototype);a.prototype.constructor=a;if($jscomp.setPrototypeOf){var g=$jscomp.setPrototypeOf;g(a,b)}else for(g in b)if("prototype"!=g)if(Object.defineProperties){var h=Object.getOwnPropertyDescriptor(b,g);h&&Object.defineProperty(a,g,h)}else a[g]=b[g];a.superClass_=b.prototype};$jscomp.arrayFromIterator=function(a){for(var b,g=[];!(b=a.next()).done;)g.push(b.value);return g};
$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};
(function(a,b){function g(){return $jscomp.executeAsyncGenerator(function(){function c(c,d,f){for(;;)switch(a){case 0:if(!u){a=1;break}a=-1;return{value:u,done:!0};case 1:return a=-1,{value:new Promise(function(a,c){var d=indexedDB.open("netflix.player");d.onerror=function(a){c(new J("Erro ao abrir BD",this.result))};d.onsuccess=function(d){d=d.target.result;try{var f=d.transaction(["namedatapairs"]).objectStore("namedatapairs").get("mslstore");f.onerror=function(a){c(new J("Erro ao obter objeto do BD",
this.result))};f.onsuccess=function(c){u=c.target.result.data;u.sequencenumber=JSON.parse(atob(u.masterTokenJSON.tokendata)).sequencenumber;a(u)}}catch(E){c(new J("Erro ao iniciar transa\u00e7\u00e3o",E))}}}),done:!0};default:return{value:void 0,done:!0}}}var a=0,d={next:function(a){return c(0,a,void 0)},throw:function(a){return c(1,void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();d[Symbol.iterator]=function(){return this};return d}())}function h(a,
f){var c={headers:{"Content-Type":"text/plain"},credentials:"include"};Object.keys(f||{}).forEach(function(a){"headers"===a?Object.keys(headers).forEach(function(a){return c.headers[a]=f.headers[a]}):c[a]=f[a]});c.method="POST";return fetch(a,c).then(function(a){return a.text()})}function e(a){return $jscomp.executeAsyncGenerator(function(){function c(c,f,l){for(;;)switch(d){case 0:return d=1,{value:crypto.subtle.sign({name:"HMAC"},u.hmacKey,R.encode(a)).then(function(a){return new Uint8Array(a)}),
done:!1};case 1:if(1!=c){d=2;break}d=-1;throw l;case 2:return b=k=f,d=-1,{value:C.fromByteArray(b),done:!0};default:return{value:void 0,done:!0}}}var d=0,b,k,l={next:function(a){return c(0,a,void 0)},throw:function(a){return c(1,void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();l[Symbol.iterator]=function(){return this};return l}())}function x(a){var c=new Uint8Array(a);for(--a;0<=a;--a)c[a]=256*Math.random();return c}function w(a){return $jscomp.executeAsyncGenerator(function(){function c(c,
f,m){for(;;)switch(d){case 0:return n=x(16),l={keyid:u.esn+"_"+u.sequencenumber,sha256:"AA==",iv:C.fromByteArray(n)},d=1,{value:crypto.subtle.encrypt({name:"AES-CBC",iv:n},u.encryptionKey,R.encode(a)).then(function(a){return new Uint8Array(a)}),done:!1};case 1:if(1!=c){d=2;break}d=-1;throw m;case 2:return b=k=f,l.ciphertext=C.fromByteArray(b),d=-1,{value:JSON.stringify(l),done:!0};default:return{value:void 0,done:!0}}}var d=0,b,k,l,n,m={next:function(a){return c(0,a,void 0)},throw:function(a){return c(1,
void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();m[Symbol.iterator]=function(){return this};return m}())}function M(){return $jscomp.executeAsyncGenerator(function(){function a(a,c,k){for(;;)switch(f){case 0:return f=1,{value:crypto.subtle.exportKey("spki",u.keyxPublicKey).then(function(a){return new Uint8Array(a)}),done:!1};case 1:if(1!=a){f=2;break}f=-1;throw k;case 2:return d=b=c,f=-1,{value:C.fromByteArray(d),done:!0};default:return{value:void 0,
done:!0}}}var f=0,d,b,k={next:function(c){return a(0,c,void 0)},throw:function(c){return a(1,void 0,c)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();k[Symbol.iterator]=function(){return this};return k}())}function G(a){return $jscomp.executeAsyncGenerator(function(){function c(c,f,m){for(;;)switch(d){case 0:return n=Math.random()*Math.pow(2,52),k=l={sender:u.esn,capabilities:{languages:[],compressionalgos:a&&(Array.isArray(a)?a:[a])||[]},renewable:!0,messageid:n},
d=1,{value:M(),done:!1};case 1:if(1!=c){d=2;break}d=-1;throw m;case 2:b=f;k.keyrequestdata=[{scheme:"ASYMMETRIC_WRAPPED",keydata:{publickey:b,mechanism:"JWK_RSA",keypairid:"rsaKeypairId"}}];if(u.userList&&u.userList.length){c=[];f=$jscomp.makeIterator(u.userList[0].serviceTokenJSONList);for(m=f.next();!m.done;m=f.next())c.push(m.value);l.useridtoken=u.userList[0].userIdTokenJSON;l.servicetokens=c}l.userauthdata={scheme:"NETFLIXID",authdata:{}};d=-1;return{value:{id:n,header:JSON.stringify(l)},done:!0};
default:return{value:void 0,done:!0}}}var d=0,b,k,l,n,m={next:function(a){return c(0,a,void 0)},throw:function(a){return c(1,void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();m[Symbol.iterator]=function(){return this};return m}())}function H(a){return $jscomp.executeAsyncGenerator(function(){function c(c,f,t){for(;;)switch(d){case 0:return d=1,{value:G(),done:!1};case 1:if(1!=c){d=2;break}d=-1;throw t;case 2:return N=ba=f,d=3,{value:w(N.header),done:!1};
case 3:if(1!=c){d=4;break}d=-1;throw t;case 4:return h=p=f,g=u.masterTokenJSON,v=btoa(h),d=5,{value:e(h),done:!1};case 5:if(1!=c){d=6;break}d=-1;throw t;case 6:return S=f,r={mastertoken:g,headerdata:v,signature:S},E='[{},{"headers":{},"path":"/cbp/cadmium-13","payload":{"data":"'+JSON.stringify(a).replace(/"/g,'\\"')+'"},"query":""}]',y=C.fromByteArray(ca.compress(E)),q={messageid:N.id,data:y,compressionalgo:"LZW",sequencenumber:1,endofmsg:!0},d=7,{value:w(JSON.stringify(q)),done:!1};case 7:if(1!=
c){d=8;break}d=-1;throw t;case 8:return m=B=f,n=btoa(m),d=9,{value:e(m),done:!1};case 9:if(1!=c){d=10;break}d=-1;throw t;case 10:return l=f,k={payload:n,signature:l},b=JSON.stringify(r)+JSON.stringify(k),d=-1,{value:b,done:!0};default:return{value:void 0,done:!0}}}var d=0,b,k,l,n,m,B,q,y,E,r,S,v,g,h,p,N,ba,x={next:function(a){return c(0,a,void 0)},throw:function(a){return c(1,void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();x[Symbol.iterator]=function(){return this};
return x}())}function Y(a){return $jscomp.executeAsyncGenerator(function(){function c(c,f,t){for(;;)switch(d){case 0:return d=1,{value:g(),done:!1};case 1:if(1!=c){d=2;break}d=-1;throw t;case 2:return q={method:"manifest",lookupType:"PREPARE",viewableIds:Array.isArray(a)?a:[a],profiles:"playready-h264bpl30-dash playready-h264mpl30-dash heaac-2-dash ddplus-2.0-dash ddplus-atmos-dash ddplus-5.1-dash dd-5.1-elem dfxp-ls-sdh".split(" "),drmSystem:"widevine",appId:"14673889385265",sessionParams:{pinCapableClient:!1,
uiplaycontext:"null"},sessionId:"14673889385265",trackId:0,flavor:"PRE_FETCH",secureUrls:!0,supportPreviewContent:!0,forceClearStreams:!1,languages:["en-US"],clientVersion:"4.0004.899.011",uiVersion:"akira"},d=3,{value:H(q),done:!1};case 3:if(1!=c){d=4;break}d=-1;throw t;case 4:return m=e=f,d=5,{value:h(da.manifest,{body:m}),done:!1};case 5:if(1!=c){d=6;break}d=-1;throw t;case 6:l=n=f;d=7;c=aa;t=l;for(var y=[],B=t.indexOf('payload":"');~B;)B+=10,f=t.indexOf('"',B),y.push(t.slice(B,f)),B=t.indexOf('payload":"',
f);return{value:c(y),done:!1};case 7:if(1!=c){d=8;break}d=-1;throw t;case 8:return b=k=f,d=-1,{value:b,done:!0};default:return{value:void 0,done:!0}}}var d=0,b,k,l,n,m,e,q,y={next:function(a){return c(0,a,void 0)},throw:function(a){return c(1,void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();y[Symbol.iterator]=function(){return this};return y}())}function aa(a){return $jscomp.executeAsyncGenerator(function(){function c(c,f,t){for(;;)switch(d){case 0:r=
"",g=$jscomp.makeIterator(a),y=g.next();case 1:if(y.done){d=3;break}q=y.value;e=JSON.parse(atob(q));m=C.toByteArray(e.iv);n=C.toByteArray(e.ciphertext);d=4;return{value:crypto.subtle.decrypt({name:"AES-CBC",iv:m},u.encryptionKey,n).then(function(a){return new Uint8Array(a)}),done:!1};case 4:if(1!=c){d=5;break}d=-1;throw t;case 5:k=l=f,b=JSON.parse((new TextDecoder).decode(k)),r+=atob(b.data);case 2:y=g.next();d=1;break;case 3:return r=JSON.parse(r)[1].payload.data,r=atob(r),d=-1,{value:JSON.parse(r),
done:!0};default:return{value:void 0,done:!0}}}var d=0,b,k,l,n,m,e,q,y,g,r,h={next:function(a){return c(0,a,void 0)},throw:function(a){return c(1,void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();h[Symbol.iterator]=function(){return this};return h}())}function Z(a){return new Promise(function(c){setTimeout(c,a)})}function A(a,f){if(a){var c=a;Array.isArray(c)?c=!0:(c=Object.prototype.toString.call(c),c="[object HTMLCollection]"===c||"[object NodeList]"===
c?!0:!1);c||(a=[a]);for(c=a.length-1;0<=c;--c)a[c].style.display=f}}function I(a){A(a,"none")}function p(a,f){f=void 0===f?document:f;return f.querySelector(a)}function T(a,f){f=void 0===f?document:f;return f.querySelectorAll(a)}function F(a,f){a=""+a;return"0".repeat(Math.max(0,f-a.length))+a}function ea(a){var c=function(a){var c=Math.round(~~a.substr(-8,7)/1E4);a=~~a.slice(0,-8);var d=a%60,b=Math.floor(a/60%60);return F(Math.floor(a/3600),2)+":"+F(b,2)+":"+F(d,2)+","+F(c,3)},d=(new DOMParser).parseFromString(a,
"text/xml"),b=[];a=d.getElementsByTagName("style");for(var k=a.length-1;0<=k;--k){var l=a[k];"italic"===l.getAttribute("tts:fontStyle")&&b.push(l.getAttribute("xml:id"))}a=function(a,c){return~b.indexOf(c.getAttribute("style"))?"<i>"+a+"</i>":a};k=/<\/i>\n<i>/g;d=d.getElementsByTagName("p");l=d.length;for(var n=[],m=0,e=0,q;m<l;){for(var y=d[m++],g=y.childNodes,r=g.length,h="",v=0;v<r;++v){var p=g[v];"br"===p.tagName?h+="\n":p.textContent&&(h="span"===p.tagName?h+a(p.textContent,p):h+p.textContent)}h&&
(g=c(y.getAttribute("begin")),r=c(y.getAttribute("end")),h=a(h,y),g===q?n[e-1]+="\n"+h.replace(k,"\n"):n[e]=++e+"\n"+g+" --\x3e "+r+"\n"+h.replace(k,"\n"),q=g)}n.push("");return n.join("\n\n")}function fa(a){if((a=p(".video-title > div")||p(".player-status"))&&1<a.children.length){a=a.children;var c=/(\d+):.+?(\d+)$/.exec(a[1].textContent);return a[0].textContent+".S"+F(c[1],2)+"E"+F(c[2],2)}return a&&a.textContent||""}function ha(a,b){var c=URL.createObjectURL(a);a=document.createElement("a");a.style.display=
"none";a.download=b;a.href=c;document.body.appendChild(a);a.click();a.remove();setTimeout(function(){return URL.revokeObjectURL(c)},1E4)}function ia(a,b){for(var c=0,f=a.length;c<f;++c)a[c].addEventListener("click",b)}function U(a,b){return b.includes(a)?a:b[0]}function V(a,b){for(var c="pt-BR"===navigator.language?"For\u00e7ada":"Forced",f=0,k=a.length;f<k;++f){var l=a[f],n=l.bcp47;if(n){b[n]||(b[n]={});n=b[n];var m=l.downloadables;if("AUDIO"===l.type){l="ASSISTIVE"===l.trackType?"-ad":"";for(var e=
m.length-1;0<=e;--e){var q=m[e],g=q.contentProfile+l,h=q.id.split(";")[1];q={bitrate:q.bitrate,type:"AUDIO",text:q.bitrate+"kbps",downloadUrl:q.urls[h]};if(!n[g])n[g]=[];else if(n[g][0].bitrate<q.bitrate){n[g].unshift(q);continue}n[g].push(q)}}else"TEXT"===l.type&&m&&(e=m[0],m=e.contentProfile,g=e.id.split(";")[1],n[m]||(n[m]=[]),q="CLOSEDCAPTIONS"===l.trackType?" [CC]":"",l={isForced:l.isForced,type:"SUBTITLES",isCC:""!==q,text:l.isForced?c+q:"Normal"+q,downloadUrl:e.urls[g]},l.isForced?n[m].push(l):
n[m].unshift(l))}}}function ja(a){var c={};if(!1===a.success)throw new O(a.result.data.cause.value.result.errorDisplayMessage,a.result.data.cause.value);var d=a.result.viewables[0];V(d.audioTracks,c);V(d.textTracks,c);var e={"ddplus-atmos-dash":0,"ddplus-atmos-dash-ad":1,"dd-5.1-elem":2,"dd-5.1-elem-ad":3,"ddplus-5.1-dash":4,"ddplus-5.1-dash-ad":5,"ddplus-2.0-dash":6,"ddplus-2.0-dash-ad":7,"heaac-2-dash":8,"heaac-2-dash-ad":9,"dfxp-ls-sdh":10},k=Object.keys(c),l={"ddplus-atmos-dash":"E-AC-3 5.1 ATMOS:",
"dd-5.1-elem":"AC-3 5.1:","ddplus-5.1-dash":"E-AC-3 5.1:","ddplus-2.0-dash":"E-AC-3 2.0:","heaac-2-dash":"AAC 2.0:","dfxp-ls-sdh":"pt-BR"===navigator.language?"Legendas:":"Subtitles:"};Object.keys(l).forEach(function(a){a.startsWith("dfxp")||(l[a+"-ad"]=l[a].replace(":"," [AD]:"))});a=document.createElement("section");a.id="flix-manifest";a.setAttribute("data-movieid",d.movieId);a.innerHTML='\n        <div class="flix-middle">\n          <div class="flix-select">\n          <select name="flix-lang" id="flix-lang">\n            '+
k.map(function(a){return'<option value="'+a+'">'+a+"</option>"}).join("")+'\n          </select>\n          </div>\n          <div class="flix-select">\n          <select name="flix-subtitle-type" id="flix-subtitle-type">\n            <option value="SRT">SRT</option>\n            <option value="DFXP">DFXP</option>\n          </select>\n          </div>\n          <div class="flix-select">\n          <select name="flix-charset" id="flix-charset">\n            <option value="UTF8">UTF-8</option>\n            <option value="UTF8B">UTF-8 BOM</option>\n            <option value="ANSI">ANSI</option>\n          </select>\n          </div>\n        </div>\n        '+
k.map(function(a){return'<div data-lang="'+a+'" class="flix-content">\n        '+Object.keys(c[a]).sort(function(a,c){return e[a]-e[c]}).map(function(b){return"<ul><li>"+l[b]+"</li>\n          "+c[a][b].map(function(a){return'<li><a data-type="'+a.type+'" '+("SUBTITLES"===a.type?'data-isforced="'+a.isForced+'" data-iscc="'+a.isCC+'"':"")+' href="'+a.downloadUrl+'">'+a.text+"</a></li>"}).join("")+"\n          </ul>"}).join("")+"\n        </div>\n        "}).join("")+"\n        ";var n=p("#flix-lang",
a),m=p("#flix-subtitle-type",a),g=p("#flix-charset",a),q=T(".flix-content",a),h=Object.create(null),E=fa()||"subtitle";ia(T('a[data-type="SUBTITLES"]',a),function(a){a.preventDefault();var c="true"===this.getAttribute("data-iscc"),d="true"===this.getAttribute("data-isforced"),f=n.value,l=g.value,k=m.value;fetch(this.href).then(function(a){if(!a.ok)throw Error(a.statusText);return"DFXP"===k?a.blob():a.text()}).then(function(a){if(a instanceof Blob){var b=a;a="dfxp"}else{a=ea(a);a=a.replace(/(\r)?\n/g,
"\r\n");b=[];switch(l.toUpperCase()){case "ANSI":for(var k=new Uint8Array(a.length),e=0,m=a.length;e<m;++e){var n=a.charCodeAt(e);k[e]=256>n?n:37}b.push(k);break;case "UTF8B":b.push("\ufeff");default:b.push(a)}b=new Blob(b,{type:"application/octet-stream"});a="srt"}ha(b,""+E+(c?".[CC]":"")+"."+f+(d?".forced":"")+"."+a)}).catch(b.error)});m.addEventListener("change",function(){g.disabled="DFXP"===this.value?"disabled":"";localStorage.setItem("flix-subtitle-type",this.value)});g.addEventListener("change",
function(){localStorage.setItem("flix-charset",this.value)});n.value=localStorage.getItem("flix-lang")||"en";for(d=q.length-1;0<=d;--d)k=q[d],h[k.getAttribute("data-lang")]=k,k.style.display="none";if(d=h[n.value])d.style.display="";n.addEventListener("change",function(){localStorage.setItem("flix-lang",this.value);I(q);h[this.value].style.display=""});m.value=U(localStorage.getItem("flix-subtitle-type"),["SRT","DFXP"]);g.value=U(localStorage.getItem("flix-charset"),["UTF8","UTF8B","ANSI"]);d=new Event("change");
m.dispatchEvent(d);g.dispatchEvent(d);return a}function K(a){return"none"===a.style.display}function ka(){return $jscomp.executeAsyncGenerator(function(){function a(a,c,h){for(;;)switch(f){case 0:if(K(z)){f=1;break}I(z);f=-1;return{value:void 0,done:!0};case 1:if(K(L)){f=2;break}W.pause();A(z,"");f=-1;return{value:void 0,done:!0};case 2:q=/^\/watch\/(\d{4,})$/.exec(location.pathname);try{if(!q){f=5;break}W.pause();m=q[1];if(D.getAttribute("data-movieid")!==m){f=6;break}A(z,"");f=-1;return{value:void 0,
done:!0}}catch(v){g=v;f=3;break}case 6:try{return D.remove(),A(z,""),A(L,""),f=7,{value:Y([parseInt(m)]),done:!1}}catch(v){g=v;f=3;break}case 7:try{if(1!=a){f=8;break}f=-1;throw h;}catch(v){g=v;f=3;break}case 8:try{l=n=c,console.log(l),D=ja(l),P.appendChild(D)}catch(v){g=v;f=3;break}case 5:try{f=4;break}catch(v){g=v;f=3;break}case 3:k=g,b.error(k),e=document.createElement("section"),e.setAttribute("data-movieid","0"),e.id="flix-manifest",d=document.createElement("div"),d.className="flix-error",d.textContent=
k.message,e.appendChild(d),D=e,P.appendChild(D);case 4:I(L),f=-1;default:return{value:void 0,done:!0}}}var f=0,d,e,k,l,n,m,g,q,h={next:function(c){return a(0,c,void 0)},throw:function(c){return a(1,void 0,c)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();h[Symbol.iterator]=function(){return this};return h}())}function la(){document.body.addEventListener("keydown",function(a){K(z)||a.stopPropagation();a.altKey&&a.shiftKey&&78===a.which&&ka()},!0);document.body.addEventListener("keydown",
function(a){27!==a.which||K(z)||(I(z),a.stopPropagation())},!0)}function ma(){var a=document.createElement("div");a.id="flix-overlay";a.style.display="none";a.innerHTML='\n        <div id="flix-dialog">\n            <div class="flix-header">\n                <div class="text" title="'+Q+" v"+X+'"><img src="'+na+'"></img>'+Q+' <span class="small-text">v'+X+'</span></div>\n                <div class="small-text author">by '+oa+'</div>\n            </div>\n            <hr>\n            <div id="flix-loading" style="display: none"><div class="flix-bar"></div></div>\n            <span id="flix-dialog-close" title="'+
("pt-BR"===navigator.language?"Fechar":"Close")+'">\u00d7</span>\n            <section data-movieid="-1" id="flix-manifest"></section>\n        </div>\n        ';document.body.appendChild(a);z=p.id("flix-overlay");L=p.id("flix-loading");D=p.id("flix-manifest");P=p.id("flix-dialog");p.id("flix-dialog-close").addEventListener("click",function(){I(z)})}if(a.top===a.self){a=b.info.script;var Q=a.name,X=a.version;a=b.info.scriptMetaStr;var oa=/@author\s*(.+)/.exec(a)[1],na=/@icon\s*(.+)/.exec(a)[1],pa=
"["+Q+"]";["log","error"].forEach(function(a){b[a]=function(b){for(var c=[],f=0;f<arguments.length;++f)c[f-0]=arguments[f];console[a].apply(null,[].concat([pa],$jscomp.arrayFromIterable(c)))}});b.log("Loading...");var da={manifest:"https://www.netflix.com/api/msl/NFCDCH-LX/cadmium/manifest"},C=function(){function a(a,c,d){for(var f=[],e=c;e<d;e+=3)c=(a[e]<<16)+(a[e+1]<<8)+a[e+2],f.push(b[c>>18&63]+b[c>>12&63]+b[c>>6&63]+b[c&63]);return f.join("")}for(var b=[],d=[],e=0;64>e;++e)b[e]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e],
d["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(e)]=e;d[45]=62;d[95]=63;return{toByteArray:function(a){var b;var c=b=a.length;if(0<c%4)throw Error("Invalid string. Length must be a multiple of 4");c="="===a[c-2]?2:"="===a[c-1]?1:0;var f=new Uint8Array(3*b/4-c);var e=0<c?b-4:b;var k=0;for(b=0;b<e;b+=4){var g=d[a.charCodeAt(b)]<<18|d[a.charCodeAt(b+1)]<<12|d[a.charCodeAt(b+2)]<<6|d[a.charCodeAt(b+3)];f[k++]=g>>16&255;f[k++]=g>>8&255;f[k++]=g&255}2===c?(g=d[a.charCodeAt(b)]<<
2|d[a.charCodeAt(b+1)]>>4,f[k++]=g&255):1===c&&(g=d[a.charCodeAt(b)]<<10|d[a.charCodeAt(b+1)]<<4|d[a.charCodeAt(b+2)]>>2,f[k++]=g>>8&255,f[k++]=g&255);return f},fromByteArray:function(c){for(var d=c.length,f=d%3,e="",g=[],k=0,h=d-f;k<h;k+=16383)g.push(a(c,k,k+16383>h?h:k+16383));1===f?(c=c[d-1],e+=b[c>>2],e+=b[c<<4&63],e+="=="):2===f&&(c=(c[d-2]<<8)+c[d-1],e+=b[c>>10],e+=b[c>>4&63],e+=b[c<<2&63],e+="=");g.push(e);return g.join("")}}}(),J=function(a,b){a=Error.call(this,a);this.message=a.message;"stack"in
a&&(this.stack=a.stack);this._error=b};$jscomp.inherits(J,Error);$jscomp.global.Object.defineProperties(J.prototype,{error:{configurable:!0,enumerable:!0,get:function(){return this._error}}});var u,ca=function(){function a(a,b){var c=b||a.length;return a.reduce(function(a,b,d){return d<c?a+String.fromCharCode(b):a},"")}for(var b=Object.create(null),d=0;256>d;++d)b[String.fromCharCode(d)]=d;var e=new TextEncoder;return{compress:function(c){function d(a,b){for(;0<b;){if(p>=f.length)return!1;var c=a;
if(b>r)c>>>=b-r,f[p]|=c&255,b-=r,r=8,++p;else{c<<=r-b;c&=255;c>>>=8-r;f[p]|=c&255;r-=b;0===r&&(r=8,++p);break}}return!0}c=e.encode(c);var f=new Uint8Array(c.length),g=Object.create(null),k=c.length,h=[];for(t in b)g[t]=b[t];var t=256;var p=0,r;var u=r=8;for(var v=0;v<k;++v){var w=c[v];h.push(w);var x=a(h);if(!g[x]){h=a(h,h.length-1);if(!d(g[h],u))return null;0!==t>>u&&++u;g[x]=t++;h=[w]}}return 0<h.length&&!d(g[a(h)],u)?null:f.subarray(0,8>r?p+1:p)}}}(),R=new TextEncoder;p.id=function(a,b){b=void 0===
b?document:b;return b.getElementById(a)};p.waitDOM=function(){return new Promise(function(a){"loading"!==document.readyState?a():document.addEventListener("DOMContentLoaded",a)})};var W=function(){return{pause:function(){return $jscomp.executeAsyncGenerator(function(){function a(a,c,e){for(;;)switch(b){case 0:return b=1,{value:Z(1500),done:!1};case 1:if(1!=a){b=2;break}b=-1;throw e;case 2:(d=p(".button-nfplayerPause")||p(".icon-player-pause"))&&d.click(),b=-1;default:return{value:void 0,done:!0}}}
var b=0,d,e={next:function(b){return a(0,b,void 0)},throw:function(b){return a(1,void 0,b)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();e[Symbol.iterator]=function(){return this};return e}())}}}(),O=function(a,b){a=Error.call(this,a);this.message=a.message;"stack"in a&&(this.stack=a.stack);this.name="ManifestError";this._cause=b};$jscomp.inherits(O,Error);$jscomp.global.Object.defineProperties(O.prototype,{cause:{configurable:!0,enumerable:!0,get:function(){return this._cause}}});
var z,L,D,P;(function(){return $jscomp.executeAsyncGenerator(function(){function a(a,c,d){for(;;)switch(b){case 0:return a=document.createElement("style"),a.textContent='\n    @font-face {\n    font-family: \'eu-bold\';\n    font-weight: normal;\n    font-style: normal;\n    src: url(\'//flixscript.github.io/font/eu.woff2\') format(\'woff2\');\n}\n#flix-overlay {\n    background-color: rgba(46, 46, 46, .9);\n    margin: 0;\n    padding: 0;\n    border: 0;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    position: fixed;\n    overflow: hidden;\n    z-index: 3000;\n}\n#flix-dialog {\n    font-family: "eu-bold";\n    font-size: 16px;\n    background: none repeat scroll 0 0 padding-box #242223;\n    box-shadow: 0 0 10px #000;\n    box-sizing: border-box;\n    color: #fff;\n    top: 50%;\n    left: 50%;\n    position: absolute;\n    margin: -150px 0px 0px -330px;\n    padding: 7px;\n    width: 580px;\n    height: 320px;\n    display: flex;\n    flex-direction: column;\n    line-height: 1;\n}\n#flix-dialog section, .flix-content ul {\n    margin: 0;\n    padding: 0;\n    border: 0;\n}\n\n#flix-dialog hr {\n    margin-left: 0;\n    margin-right: 0;\n    border: 0;\n    background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(256, 245, 254, 0.75), rgba(0, 0, 0, 0));\n    height: 1px;\n}\n\n.flix-header {\n    display: flex;\n    line-height: 32px;\n    margin: 5px 5px 0;\n}\n\n.flix-header img {\n    margin-right: 6px;\n    height: 26px;\n    width: 26px;\n    vertical-align: sub;\n}\n\n.flix-header .text {\n    font-size: 23px;\n    color: #bd0c0c;\n    flex-grow: 1;\n    text-align: center;\n}\n.flix-header .small-text {\n    font-size: 9px;\n    color: #746D6D;\n    vertical-align: middle;\n}\n\n.flix-header .author {\n    text-align: right;\n}\n\n#flix-dialog-close {\n    position: absolute;\n    top: 5px;\n    right: 5px;\n    line-height: 12px;\n    text-decoration: none;\n    cursor: pointer;\n}\n\n.flix-middle {\n    display: flex;\n    justify-content: center;\n}\n\n#flix-dialog label {\n    line-height: 22px;\n    font-size: 13px;\n}\n\n#flix-dialog select {\n    background-color: #272525;\n    border: 1px solid #120202;\n    border-radius: 3px;\n    color: #fff;\n    cursor: pointer;\n    margin-left: 3px;\n    font-family: "eu-bold";\n    font-size: 12px;\n    outline: 0;\n    -webkit-appearance: none;\n    -moz-appearance: none;\n    appearance: none;\n    padding: 3px 24px;\n}\n\n#flix-dialog select:disabled {\n    opacity: 0.3;\n    cursor: not-allowed;\n}\n\n.flix-select {\n    position: relative;\n}\n\n.flix-select:after {\n    content: ">";\n    color: #FFF;\n    -webkit-transform: rotate(90deg);\n    -moz-transform: rotate(90deg);\n    transform: rotate(90deg);\n    right: 11px;\n    top: 5px;\n    font-size: 11px;\n    position: absolute;\n}\n\n#flix-dialog a {\n    color: #b7a8a8;\n    text-decoration: none;\n}\n\n#flix-dialog a:hover {\n    color: #e93e30;\n}\n\n.flix-content {\n    margin: 24px 0 0 48px;\n}\n.flix-content ul, .flix-content li {\n    list-style: none;\n}\n.flix-content ul {\n    display: flex;\n    flex-direction: row;\n    margin-top: 10px;\n}\n.flix-content li:first-child {\n    width: 150px;\n}\n.flix-content li {\n    margin-left: 3px;\n}\n.flix-content li:not(:nth-child(1)) + li:before {\n    content: " | ";\n}\n.flix-item {\n    margin-top: 5px;\n}\n#flix-loading {\n  position: relative;\n  margin-bottom: 5px;\n  width: 100%;\n  height: 12px;\n  background-color: #3b3a38;\n  border-radius: 4px;\n}\n.flix-bar {\n  content: "";\n  display: inline;\n  position: absolute;\n  width: 0;\n  height: 100%;\n  left: 50%;\n  text-align: center;\n  background-color: #e9250a;\n  border-radius: 4px;\n  animation: floading 4s linear infinite;\n}\n@keyframes floading {\n    from {\n        left: 50%;\n        width: 0;\n    }\n    to {\n        left: 0;\n        width: 100%;\n    }\n}\n\n.flix-error {\n    text-align: center;\n    line-height: 30px;\n    background-color: brown;\n}',
a.type="text/css",(document.head||document.documentElement).appendChild(a),b=1,{value:p.waitDOM(),done:!1};case 1:if(1!=a){b=2;break}b=-1;throw d;case 2:ma(),la(),b=-1;default:return{value:void 0,done:!0}}}var b=0,d={next:function(b){return a(0,b,void 0)},throw:function(b){return a(1,void 0,b)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();d[Symbol.iterator]=function(){return this};return d}())})()}})(window,"undefined"!==typeof GM&&GM||{info:GM_info})}).call(window);
/* jshint ignore:end */