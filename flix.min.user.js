// ==UserScript==
// @name        Flix
// @description User script para facilitar download de legendas e Ã¡udios na(o) Netflix
// @include     https://www.netflix.com/*
// @copyright   2017, XOR
// @author      XOR
// @version     1.0.3
// @namespace   @XOR
// @icon        data:image/png;base64,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
// @grant       none
// @homepageURL https://gist.github.com/xor10/8f65c1e66a34386e1131f8c28ff6bf64
// @downloadURL https://gist.github.com/xor10/8f65c1e66a34386e1131f8c28ff6bf64/raw/flix.min.user.js
// @updateURL   https://gist.github.com/xor10/8f65c1e66a34386e1131f8c28ff6bf64/raw/flix.min.user.js
// @run-at      document-start
// ==/UserScript==
'use strict';var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,f,h){a!=Array.prototype&&a!=Object.prototype&&(a[f]=h.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var f=0;return $jscomp.iteratorPrototype(function(){return f<a.length?{done:!1,value:a[f++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();var f=a[Symbol.iterator];return f?f.call(a):$jscomp.arrayIterator(a)};
$jscomp.polyfill=function(a,f,h,m){if(f){h=$jscomp.global;a=a.split(".");for(m=0;m<a.length-1;m++){var e=a[m];e in h||(h[e]={});h=h[e]}a=a[a.length-1];m=h[a];f=f(m);f!=m&&null!=f&&$jscomp.defineProperty(h,a,{configurable:!0,writable:!0,value:f})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function f(){this.batch_=null}function h(c){return c instanceof e?c:new e(function(a,e){a(c)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;f.prototype.asyncExecute=function(c){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(c);return this};f.prototype.asyncExecuteBatch_=function(){var c=this;this.asyncExecuteFunction(function(){c.executeBatch_()})};var m=$jscomp.global.setTimeout;f.prototype.asyncExecuteFunction=function(c){setTimeout(c,
0)};f.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var c=this.batch_;this.batch_=[];for(var a=0;a<c.length;++a){var e=c[a];delete c[a];try{e()}catch(u){this.asyncThrow_(u)}}}this.batch_=null};f.prototype.asyncThrow_=function(c){this.asyncExecuteFunction(function(){throw c;})};var e=function(c){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var a=this.createResolveAndReject_();try{c(a.resolve,a.reject)}catch(B){a.reject(B)}};e.prototype.createResolveAndReject_=
function(){function c(c){return function(D){e||(e=!0,c.call(a,D))}}var a=this,e=!1;return{resolve:c(this.resolveTo_),reject:c(this.reject_)}};e.prototype.resolveTo_=function(c){if(c===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(c instanceof e)this.settleSameAsPromise_(c);else{a:switch(typeof c){case "object":var a=null!=c;break a;case "function":a=!0;break a;default:a=!1}a?this.resolveToNonPromiseObj_(c):this.fulfill_(c)}};e.prototype.resolveToNonPromiseObj_=function(c){var a=
void 0;try{a=c.then}catch(B){this.reject_(B);return}"function"==typeof a?this.settleSameAsThenable_(a,c):this.fulfill_(c)};e.prototype.reject_=function(c){this.settle_(2,c)};e.prototype.fulfill_=function(c){this.settle_(1,c)};e.prototype.settle_=function(c,a){if(0!=this.state_)throw Error("Cannot settle("+c+", "+a|"): Promise already settled in state"+this.state_);this.state_=c;this.result_=a;this.executeOnSettledCallbacks_()};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=
this.onSettledCallbacks_,e=0;e<a.length;++e)a[e].call(),a[e]=null;this.onSettledCallbacks_=null}};var w=new f;e.prototype.settleSameAsPromise_=function(a){var c=this.createResolveAndReject_();a.callWhenSettled_(c.resolve,c.reject)};e.prototype.settleSameAsThenable_=function(a,e){var c=this.createResolveAndReject_();try{a.call(e,c.resolve,c.reject)}catch(u){c.reject(u)}};e.prototype.then=function(a,f){function c(a,c){return"function"==typeof a?function(c){try{u(a(c))}catch(E){h(E)}}:c}var u,h,m=new e(function(a,
c){u=a;h=c});this.callWhenSettled_(c(a,u),c(f,h));return m};e.prototype.catch=function(a){return this.then(void 0,a)};e.prototype.callWhenSettled_=function(a,e){function c(){switch(f.state_){case 1:a(f.result_);break;case 2:e(f.result_);break;default:throw Error("Unexpected state: "+f.state_);}}var f=this;null==this.onSettledCallbacks_?w.asyncExecute(c):this.onSettledCallbacks_.push(function(){w.asyncExecute(c)})};e.resolve=h;e.reject=function(a){return new e(function(c,e){e(a)})};e.race=function(a){return new e(function(c,
e){for(var f=$jscomp.makeIterator(a),m=f.next();!m.done;m=f.next())h(m.value).callWhenSettled_(c,e)})};e.all=function(a){var c=$jscomp.makeIterator(a),f=c.next();return f.done?h([]):new e(function(a,e){function m(c){return function(e){u[c]=e;w--;0==w&&a(u)}}var u=[],w=0;do u.push(void 0),w++,h(f.value).callWhenSettled_(m(u.length-1),e),f=c.next();while(!f.done)})};return e},"es6-impl","es3");
$jscomp.executeAsyncGenerator=function(a){function f(f){return a.next(f)}function h(f){return a.throw(f)}return new Promise(function(m,e){function w(a){a.done?m(a.value):Promise.resolve(a.value).then(f,h).then(w,e)}w(a.next())})};
(function(){function a(){var a=/^(.*?)@(.+?):(\d+):(\d+)$/,d=Error().stack.split("\n").slice(2),b=a.exec(d[0]);this.lineNumber=parseInt(b[3],10);this.columnNumber=parseInt(b[4],10);var c=[];d.forEach(function(b){b&&(b=a.exec(b),c.push(b[1]+"@"+b[3]+":"+b[4]))});this.stack=c.join("\n")}function f(g){a.call(this);this.message=g}function h(){return $jscomp.executeAsyncGenerator(function(){function a(b,a){for(;;)switch(d){case 0:if(!p){d=1;break}d=-1;return{value:p,done:!0};case 1:return d=-1,{value:new Promise(function(b,
a){a=indexedDB.open("netflix.player");a.onerror=function(a){console.info("open db error",a);b()};a.onsuccess=function(a){a=a.target.result;try{var d=a.transaction(["namedatapairs"]).objectStore("namedatapairs").get("mslstore");d.onerror=function(a){console.info("Error transition");b()};d.onsuccess=function(a){p=a.target.result.data;p.sequencenumber=JSON.parse(atob(p.masterTokenJSON.tokendata)).sequencenumber;b(p)}}catch(r){console.error(r),b()}}}),done:!0};default:return{value:void 0,done:!0}}}var d=
0,b={next:function(b){return a(b,void 0)},throw:function(b){return a(void 0,b)},return:function(b){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();b[Symbol.iterator]=function(){return this};return b}())}function m(a,d){var b={headers:{"Content-Type":"text/plain"},credentials:"include"};Object.keys(d||{}).forEach(function(a){"headers"===a?Object.keys(headers).forEach(function(a){return b.headers[a]=d.headers[a]}):b[a]=d[a]});b.method="POST";return fetch(a,b).then(function(b){return b.text()})}
function e(a){return $jscomp.executeAsyncGenerator(function(){function d(d,l){for(;;)switch(b){case 0:return b=1,{value:crypto.subtle.sign({name:"HMAC"},p.hmacKey,K.encode(a)).then(function(b){return new Uint8Array(b)}),done:!1};case 1:if(void 0===l){b=2;break}b=-1;throw l;case 2:return c=g=d,b=-1,{value:A.fromByteArray(c),done:!0};default:return{value:void 0,done:!0}}}var b=0,c,g,l={next:function(b){return d(b,void 0)},throw:function(b){return d(void 0,b)},return:function(b){throw Error("Not yet implemented");
}};$jscomp.initSymbolIterator();l[Symbol.iterator]=function(){return this};return l}())}function w(a){var d=new Uint8Array(a);for(--a;0<=a;--a)d[a]=256*Math.random();return d}function c(a){return $jscomp.executeAsyncGenerator(function(){function d(d,e){for(;;)switch(b){case 0:return g=w(16),l={keyid:p.esn+"_"+p.sequencenumber,sha256:"AA==",iv:A.fromByteArray(g)},b=1,{value:crypto.subtle.encrypt({name:"AES-CBC",iv:g},p.encryptionKey,K.encode(a)).then(function(b){return new Uint8Array(b)}),done:!1};
case 1:if(void 0===e){b=2;break}b=-1;throw e;case 2:return c=k=d,l.ciphertext=A.fromByteArray(c),b=-1,{value:JSON.stringify(l),done:!0};default:return{value:void 0,done:!0}}}var b=0,c,k,l,g,e={next:function(b){return d(b,void 0)},throw:function(b){return d(void 0,b)},return:function(b){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();e[Symbol.iterator]=function(){return this};return e}())}function D(){return $jscomp.executeAsyncGenerator(function(){function a(a,k){for(;;)switch(d){case 0:return d=
1,{value:crypto.subtle.exportKey("spki",p.keyxPublicKey).then(function(b){return new Uint8Array(b)}),done:!1};case 1:if(void 0===k){d=2;break}d=-1;throw k;case 2:return b=c=a,d=-1,{value:A.fromByteArray(b),done:!0};default:return{value:void 0,done:!0}}}var d=0,b,c,k={next:function(b){return a(b,void 0)},throw:function(b){return a(void 0,b)},return:function(b){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();k[Symbol.iterator]=function(){return this};return k}())}function B(a){return $jscomp.executeAsyncGenerator(function(){function d(d,
g){for(;;)switch(b){case 0:return e=Math.random()*Math.pow(2,52),k=l={sender:p.esn,capabilities:{languages:[],compressionalgos:a&&(Array.isArray(a)?a:[a])||[]},renewable:!0,messageid:e},b=1,{value:D(),done:!1};case 1:if(void 0===g){b=2;break}b=-1;throw g;case 2:c=d;k.keyrequestdata=[{scheme:"ASYMMETRIC_WRAPPED",keydata:{publickey:c,mechanism:"JWK_RSA",keypairid:"rsaKeypairId"}}];if(p.userList&&p.userList.length){d=[];g=$jscomp.makeIterator(p.userList[0].serviceTokenJSONList);for(var f=g.next();!f.done;f=
g.next())d.push(f.value);l.useridtoken=p.userList[0].userIdTokenJSON;l.servicetokens=d}l.userauthdata={scheme:"NETFLIXID",authdata:{}};b=-1;return{value:{id:e,header:JSON.stringify(l)},done:!0};default:return{value:void 0,done:!0}}}var b=0,c,k,l,e,g={next:function(b){return d(b,void 0)},throw:function(b){return d(void 0,b)},return:function(b){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();g[Symbol.iterator]=function(){return this};return g}())}function u(a){return $jscomp.executeAsyncGenerator(function(){function d(d,
v){for(;;)switch(b){case 0:return b=1,{value:B(),done:!1};case 1:if(void 0===v){b=2;break}b=-1;throw v;case 2:return F=h=d,b=3,{value:c(F.header),done:!1};case 3:if(void 0===v){b=4;break}b=-1;throw v;case 4:return G=T=d,M=p.masterTokenJSON,q=window.btoa(G),b=5,{value:e(G),done:!1};case 5:if(void 0===v){b=6;break}b=-1;throw v;case 6:return C=d,n={mastertoken:M,headerdata:q,signature:C},z='[{},{"headers":{},"path":"/cbp/cadmium-13","payload":{"data":"'+JSON.stringify(a).replace(/"/g,'\\"')+'"},"query":""}]',
t=A.fromByteArray(U.compress(z)),r={messageid:F.id,data:t,compressionalgo:"LZW",sequencenumber:1,endofmsg:!0},b=7,{value:c(JSON.stringify(r)),done:!1};case 7:if(void 0===v){b=8;break}b=-1;throw v;case 8:return x=y=d,f=window.btoa(x),b=9,{value:e(x),done:!1};case 9:if(void 0===v){b=10;break}b=-1;throw v;case 10:return l=d,k={payload:f,signature:l},g=JSON.stringify(n)+JSON.stringify(k),b=-1,{value:g,done:!0};default:return{value:void 0,done:!0}}}var b=0,g,k,l,f,x,y,r,t,z,n,C,q,M,G,T,F,h,m={next:function(b){return d(b,
void 0)},throw:function(b){return d(void 0,b)},return:function(b){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();m[Symbol.iterator]=function(){return this};return m}())}function O(a){return $jscomp.executeAsyncGenerator(function(){function d(d,q){for(;;)switch(b){case 0:return b=1,{value:h(),done:!1};case 1:if(void 0===q){b=2;break}b=-1;throw q;case 2:if(t=z=d){b=3;break}b=-1;throw new f("MSL is undefined!");case 3:return r={method:"manifest",lookupType:"PREPARE",viewableIds:Array.isArray(a)?
a:[a],profiles:"playready-h264bpl30-dash playready-h264mpl30-dash playready-h264mpl31-dash playready-h264mpl40-dash heaac-2-dash ddplus-2.0-dash ddplus-5.1-dash dd-5.1-elem dfxp-ls-sdh".split(" "),drmSystem:"widevine",appId:"14673889385265",sessionParams:{pinCapableClient:!1,uiplaycontext:"null"},sessionId:"14673889385265",trackId:0,flavor:"PRE_FETCH",secureUrls:!0,supportPreviewContent:!0,forceClearStreams:!1,languages:["en-US"],clientVersion:"4.0004.899.011",uiVersion:"akira"},b=4,{value:u(r),done:!1};
case 4:if(void 0===q){b=5;break}b=-1;throw q;case 5:return e=y=d,b=6,{value:m(V.manifest,{body:e}),done:!1};case 6:if(void 0===q){b=7;break}b=-1;throw q;case 7:l=g=d;b=8;d=R;q=void 0;for(var v=l,x=0,n=0,J=0,C=[],p=0,S=v.length;x<S;){var L=v.charAt(x);"{"===L&&++n;"}"===L&&++J;n===J&&(q?C.push(v.slice(p,x+1)):q=v.slice(0,x+1),p=x+1);++x}return{value:d(C[0]),done:!1};case 8:if(void 0===q){b=9;break}b=-1;throw q;case 9:return c=k=d,b=-1,{value:c,done:!0};default:return{value:void 0,done:!0}}}var b=0,
c,k,l,g,e,y,r,t,z,n={next:function(b){return d(b,void 0)},throw:function(b){return d(void 0,b)},return:function(b){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();n[Symbol.iterator]=function(){return this};return n}())}function R(a){return $jscomp.executeAsyncGenerator(function(){function d(d,v){for(;;)switch(b){case 0:return r=JSON.parse(a),f=JSON.parse(window.atob(r.payload)),g=A.toByteArray(f.iv),e=A.toByteArray(f.ciphertext),b=1,{value:crypto.subtle.decrypt({name:"AES-CBC",
iv:g},p.encryptionKey,e).then(function(b){return new Uint8Array(b)}),done:!1};case 1:if(void 0===v){b=2;break}b=-1;throw v;case 2:return k=l=d,c=JSON.parse((new TextDecoder).decode(k)),e=window.atob(c.data),e=JSON.parse(e)[1].payload.data,e=window.atob(e),b=-1,{value:JSON.parse(e),done:!0};default:return{value:void 0,done:!0}}}var b=0,c,k,l,e,g,f,r,t={next:function(b){return d(b,void 0)},throw:function(b){return d(void 0,b)},return:function(b){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();
t[Symbol.iterator]=function(){return this};return t}())}function P(){return $jscomp.executeAsyncGenerator(function(){function a(a,k){for(;;)switch(d){case 0:if(!t){d=1;break}d=-1;return{value:void 0,done:!0};case 1:t=!0;r=window.location.pathname;y=/^\/watch\/(\d{4,})$/;x=y.exec(r);if(!x){d=2;break}if(f=document.getElementById("box")){d=3;break}H=!0;l=document.createElement("div");l.id="overlay";document.body.appendChild(l);W.pause();d=5;return{value:O([parseInt(x[1])]),done:!1};case 5:if(void 0===
k){d=6;break}d=-1;throw k;case 6:c=e=a;b={};N(c.result.viewables[0].audioTracks,b,"audios");N(c.result.viewables[0].textTracks,b,"subtitles");X(b);d=4;break;case 3:H=!1,document.getElementById("overlay").remove(),f.remove();case 4:case 2:t=!1,d=-1;default:return{value:void 0,done:!0}}}var d=0,b,c,e,l,f,x,y,r,t,z={next:function(b){return a(b,void 0)},throw:function(b){return a(void 0,b)},return:function(b){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();z[Symbol.iterator]=function(){return this};
return z}())}function I(a,d){a=""+a;return"0".repeat(Math.max(0,d-a.length))+a}function Q(a){var d=function(b,a){b=""+b;return"0".repeat(Math.max(0,a-b.length))+b},b=function(b){var a=Math.round(~~b.substr(-8,7)/1E4);b=~~b.slice(0,-8);var c=b%60,e=Math.floor(b/60%60);return d(Math.floor(b/3600),2)+":"+d(e,2)+":"+d(c,2)+","+d(a,3)},c=(new DOMParser).parseFromString(a,"text/xml"),e=[];a=c.getElementsByTagName("style");for(var l=a.length-1;0<=l;--l){var f=a[l];"italic"===f.getAttribute("tts:fontStyle")&&
e.push(f.getAttribute("xml:id"))}a=function(b,a){return~e.indexOf(a.getAttribute("style"))?"<i>"+b+"</i>":b};for(var c=c.getElementsByTagName("p"),l=c.length,f="",g=0,y=1;g<l;){for(var r=c[g++],t=r.childNodes,z=t.length,n="",h=0;h<z;++h){var q=t[h];"br"===q.tagName?n+="\n":q.textContent&&(n="span"===q.tagName?n+a(q.textContent,q):n+q.textContent)}n&&(t=b(r.getAttribute("begin")),z=b(r.getAttribute("end")),n=a(n,r),f+=y++ +"\n"+t+" --\x3e "+z+"\n"+n.replace(/<\/i>\n<i>/g,"\n")+"\n\n")}return f}function E(){var a=
document.querySelector(".player-status-main-title");if(a){var d=a.nextSibling;if(d)return d=/(\d+):.+?(\d+)$/.exec(d.textContent),a.textContent+".S"+I(d[1],2)+"E"+I(d[2],2)}return a&&a.textContent||""}function X(a){function d(b,a,d){b=b.replace(/(\r)?\n/g,"\r\n");var c=[];switch(d.toUpperCase()){case "ANSI":d=new Uint8Array(b.length);for(var e=0,l=b.length;e<l;++e){var f=b.charCodeAt(e);d[e]=256>f?f:37}c.push(d);break;case "UTF8B":c.push("\ufeff");default:c.push(b)}b=new Blob(c,{type:"application/octet-stream"});
var k=window.URL.createObjectURL(b);b=document.createElement("a");b.style.display="none";b.download=a||"legenda.srt";b.href=k;setTimeout(function(){return window.URL.revokeObjectURL(k)},1E4);document.body.appendChild(b);b.click()}function b(b,a,c,l){var f=document.createElement("span"),k=document.createElement("br");f.className="prefix";f.textContent={"heaac-2-dash":"\u00c1udio 2.0 AAC:","dd-5.1-elem":"\u00c1udio 5.1 AC-3:","ddplus-2.0-dash":"\u00c1udio 2.0 E-AC-3:","dd-plus-5.1-dash":"\u00c1udio 5.1 E-AC-3:",
"dfxp-ls-sdh":"Legenda (dfxp):"}[a];c.appendChild(k);c.appendChild(f);c.appendChild(k.cloneNode());if("dfxp-ls-sdh"===a){var g=document.createDocumentFragment();f=f.cloneNode();f.textContent="Legenda (srt):";g.appendChild(f);g.appendChild(k.cloneNode())}-1===a.indexOf("dfxp")?b.sort(function(b,a){return a.bitrate-b.bitrate}):b.sort(function(b,a){return b.isForced!==a.isForced?!0===b.isForced?1:-1:0});b.forEach(function(b){var a=document.createElement("a");a.className="quality";if(b.bitrate)a.textContent=
b.bitrate+" kbps";else if(a.textContent=b.isForced?"For\u00e7ada":"Normal",!1===b.isImage){var f=document.createElement("a");f.textContent=a.textContent;f.className="quality";f.addEventListener("click",function(a){a.preventDefault();var c=a.target;c.classList.contains("quality")&&(c.classList.remove("quality"),fetch(b.url).then(function(b){return b.text()}).then(function(a){var f=document.getElementById("charsetSub");d(Q(a),e+"."+l+"."+(b.isForced?"forced.":"")+"srt",f&&f.options[f.selectedIndex].value);
c.classList.add("quality")}))});g.appendChild(f);g.appendChild(document.createTextNode("\u00a0"))}a.href=b.url;c.appendChild(a);c.appendChild(document.createTextNode("\u00a0"))});g&&2<g.children.length&&(c.appendChild(k.cloneNode()),c.appendChild(k.cloneNode()),c.appendChild(g));c.appendChild(k.cloneNode())}function c(){for(var b=m.length-1;0<=b;--b)m[b].style.display="none";document.querySelector('.select-box-content[data-lang="'+n[n.selectedIndex].value+'"]').style.display=""}var e=E(),l=document.createElement("select");
l.className="selectB";var f=document.createDocumentFragment();Object.keys(a).forEach(function(c){var d=document.createElement("option");d.value=c;d.text=c;"pt-BR"===c&&(d.selected="selected");l.add(d);var e=document.createElement("div");e.setAttribute("data-lang",c);e.className="select-box-content";Object.keys(a[c].audios||{}).map(function(b){return b.replace("ddplus-5","dd-plus-5")}).sort().forEach(function(d){return b(a[c].audios[d.replace("dd-plus-5","ddplus-5")],d,e,c)});Object.keys(a[c].subtitles||
{}).forEach(function(d){return b(a[c].subtitles[d],d,e,c)});f.appendChild(e)});var g=document.createRange().createContextualFragment('<div id="box">\n\t\t\t<div id="content">\n\t\t\t   <div id="select-box"></div>\n\t\t\t</div>\n\t\t</div>'),y=g.getElementById("select-box"),r=document.createElement("select");r.className="selectB";r.id="charsetSub";var t={UTF8:"UTF-8",UTF8B:"UTF-8 BOM",ANSI:"ANSI"},h=localStorage.getItem("charsetSub");if(null===h||"undefined"===typeof t[h])h="UTF8",localStorage.setItem("charsetSub",
h);Object.keys(t).forEach(function(b){var a=document.createElement("option");b===h&&(a.selected="selected");a.value=b;a.text=t[b];r.add(a)});y.appendChild(l);y.appendChild(r);y.parentNode.insertBefore(f,y.nextSibling);document.body.insertBefore(g,document.body.firstChild);var n=l,m=document.getElementsByClassName("select-box-content");r.addEventListener("change",function(b){b=b.target;localStorage.setItem("charsetSub",b.options[b.selectedIndex].value)});l.addEventListener("change",c);c()}function N(a,
c,b){a.forEach(function(a){a.bcp47&&(c[a.bcp47]||(c[a.bcp47]={}),c[a.bcp47][b]||(c[a.bcp47][b]={}),"ASSISTIVE"!==a.trackType&&a.downloadables&&a.downloadables.forEach(function(d){c[a.bcp47][b][d.contentProfile]||(c[a.bcp47][b][d.contentProfile]=[]);var e=d.urls[d.id.split(";").pop()];c[a.bcp47][b][d.contentProfile].push("audios"===b?{bitrate:d.bitrate,url:e}:{isForced:a.isForced,isImage:d.isImage,url:e})}))})}function Y(a){var c=document.head;if(c){var b=document.createElement("style");b.textContent=
a;b.type="text/css";c.appendChild(b);return b}}var V={manifest:"https://www.netflix.com/api/msl/NFCDCH-LX/cadmium/manifest"},A=function(){function a(b,a,d){for(var e=[],f=a;f<d;f+=3)a=(b[f]<<16)+(b[f+1]<<8)+b[f+2],e.push(c[a>>18&63]+c[a>>12&63]+c[a>>6&63]+c[a&63]);return e.join("")}for(var c=[],b=[],e=0;64>e;++e)c[e]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e],b["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(e)]=e;b[45]=62;b[95]=63;return{toByteArray:function(a){var c;
var d=c=a.length;if(0<d%4)throw Error("Invalid string. Length must be a multiple of 4");d="="===a[d-2]?2:"="===a[d-1]?1:0;var e=new Uint8Array(3*c/4-d);var f=0<d?c-4:c;var k=0;for(c=0;c<f;c+=4){var g=b[a.charCodeAt(c)]<<18|b[a.charCodeAt(c+1)]<<12|b[a.charCodeAt(c+2)]<<6|b[a.charCodeAt(c+3)];e[k++]=g>>16&255;e[k++]=g>>8&255;e[k++]=g&255}2===d?(g=b[a.charCodeAt(c)]<<2|b[a.charCodeAt(c+1)]>>4,e[k++]=g&255):1===d&&(g=b[a.charCodeAt(c)]<<10|b[a.charCodeAt(c+1)]<<4|b[a.charCodeAt(c+2)]>>2,e[k++]=g>>8&
255,e[k++]=g&255);return e},fromByteArray:function(b){for(var d=b.length,e=d%3,f="",g=[],k=0,h=d-e;k<h;k+=16383)g.push(a(b,k,k+16383>h?h:k+16383));1===e?(b=b[d-1],f+=c[b>>2],f+=c[b<<4&63],f+="=="):2===e&&(b=(b[d-2]<<8)+b[d-1],f+=c[b>>10],f+=c[b>>4&63],f+=c[b<<2&63],f+="=");g.push(f);return g.join("")}}}();f.prototype=Object.create(Error.prototype);f.prototype.constructor=f;f.prototype.name="MslException";f.prototype.toString=function(){return"Type: "+this.name+"\nMessage: "+this.message+"\nlineNumber: "+
this.lineNumber+"\ncolumnNumber: "+this.columnNumber+"\n\nStack:\n"+this.stack};var p,U=function(){function a(b,a){var c=a||b.length;return b.reduce(function(b,a,d){return d<c?b+String.fromCharCode(a):b},"")}for(var c=Object.create(null),b=0;256>b;++b)c[String.fromCharCode(b)]=b;var e=new TextEncoder;return{compress:function(b){function d(b,a){for(;0<a;){if(p>=f.length)return!1;var c=b;if(a>n)c>>>=a-n,f[p]|=c&255,a-=n,n=8,++p;else{c<<=n-a;c&=255;c>>>=8-n;f[p]|=c&255;n-=a;0===n&&(n=8,++p);break}}return!0}
b=e.encode(b);var f=new Uint8Array(b.length),g=Object.create(null),k=b.length,h=[];for(m in c)g[m]=c[m];var m=256;var p=0,n;var u=n=8;for(var q=0;q<k;++q){var w=b[q];h.push(w);var A=a(h);if(!g[A]){h=a(h,h.length-1);if(!d(g[h],u))return null;0!==m>>u&&++u;g[A]=m++;h=[w]}}return 0<h.length&&!d(g[a(h)],u)?null:f.subarray(0,8>n?p+1:p)}}}(),K=new TextEncoder,W=function(){return{pause:function(){setTimeout(function(){var a=document.querySelector(".player-control-button.player-play-pause");a&&a.classList.contains("icon-player-pause")&&
a.click()},2E3)}}}(),H=!1;window.addEventListener("DOMContentLoaded",function(){Y("#overlay {\n\t\t\tz-index: 10;\n\t\t\tposition: absolute;\n\t\t\ttop: 0;\n\t\t\tleft: 0;\n\t\t\twidth: 100%;\n\t\t\theight: 100%;\n\t\t\tbackground: #000;\n\t\t\topacity: 0.8;\n\t\t}\n\n\t\t#box {\n\t\t\tborder: 2px solid #edebd7;\n\t\t\tbox-shadow: 1px 1px 1px #6e675f;\n\t\t\tbackground: #423e37;\n\t\t\tz-index: 11;\n\t\t\tcolor: #FFF;\n\t\t\tpadding: 0.5em;\n\t    \tfont-size: 16px;\n\t    \tfont-family: 'Roboto', sans-serif;\n\t    \tfont-weight: bold;\n\t    \tline-height: 1.2em;\n\t\t\tposition: absolute;\n\t    \tmargin: 0 auto;\n\t    \ttop: 50%;\n\t\t\tleft: 50%;\n\t\t\tmargin-left: -150px;\n\t\t\tmargin-top: -150px;\n\t\t\twidth: 400px;\n\t\t\theight: 350px;\n\t\t}\n\n\t\t.selectB {\n\t\t\tcolor: #595757;\n\t\t\twidth: 120px;\n\t\t\tpadding: 0.3em;\n\t\t\tmargin: 0.3em;\n\t\t}\n\n\t\t#content {\n\t\t\ttext-align: center;\n\t\t\theight: 300px;\n\t\t}\n\n\t\t.prefix {\n\t\t\tcolor: #a19c90;\n\t\t}\n\t\t.quality {\n\t\t\ttext-decoration: none;\n\t\t\tcursor: pointer;\n\t\t\tcolor: #edebd7;\n\t\t}\n\n\t\t.quality:hover {\n\t\t\tcolor: #81a094;\n\t\t}");
document.body.addEventListener("keydown",function(a){var c=a.shiftKey,b=a.which;if(a.altKey&&c)switch(b){case 78:console.log("ok");P();return;default:console.log(":)")}H&&a.stopPropagation()},!0)})})();